/**
 * GooFlow-Vue - Web端流程设计器
 * @author foolegg126 (sdlddr)
 * @version v1.2.0
 * @license Commercially licensed to 永凯软件技术(上海)有限公司-913101157867305734(imclouds)
 **/
let tab1="  ",tab2=tab1+tab1,tab3=tab2+tab1,xmlStart='<?xml version="1.0" encoding="UTF-8"?>\n<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"\n'+tab1+'xmlns:activiti="http://activiti.org/bpmn"\n'+tab1+'xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n'+tab1+'targetNamespace="${targetNamespace}"\n'+tab1+'xsi:schemaLocation="http://www.omg.org/spec/BPMN/20100524/MODEL\n'+tab1+'http://www.omg.org/spec/BPMN/2.0/20100501/BPMN20.xsd">\n',xmlEnd="</definitions>";function renderBaseInfo(e,t,a){let r=a.left+","+a.top+","+a.width+","+a.height;return tab2+"<"+t+' id="'+e+'" g="'+r+'"'}function json2XML(e,t,a,r){let l=(r?"":"\n")+a+"<"+e,s="",o="",n=!1;for(let e in t)"object"==typeof t[e]?o+=json2XML(e,t[e],a+tab1):"text"===e?(o+=t[e],n=!0):s+=" "+e+'="'+t[e]+'"';return""===o||n||(o+="\n"+a),l+=s+(""===o?"/>":">"+o+"</"+e+">")}function transVal(e){return!isNaN(parseFloat(e))&&isFinite(e)?parseFloat(e):"true"===e||"false"!==e&&e}function Xml2Json(e,t){for(let a=0;a<e.attributes.length;++a){let r=e.attributes[a];"id"!==r.nodeName&&(t[r.nodeName]=transVal(r.nodeValue))}if(1===e.childNodes.length&&"string"==typeof e.childNodes[0].data)t.text=e.childNodes[0].data;else for(let a=0;a<e.childNodes.length;++a){let r=e.childNodes[a];"string"!=typeof r.data&&(t[r.tagName]={},Xml2Json(r,t[r.tagName]))}}export default{flag:"xml",methods:{exportBpmnXML(e){void 0===e&&(e={});let t=xmlStart.replace("${targetNamespace}",this.prop.$extra.targetNamespace||"Examples");for(let e in this.prop.$extra)if("targetNamespace"!==e&&"id"!==e){let a=this.prop.$extra[e];t+="object"==typeof a?json2XML(e,a,tab1,!0)+"\n":tab1+"<"+e+">"+a+"</"+e+">\n"}let a=this.prop.$extra.id||"myProcess",r=this.prop.$title||"My Process";t+=tab1+"<initNum>"+this.prop.$max+"</initNum>\n",t+=tab1+'<process id="'+a+'" name="'+r+'">\n';for(let e in this.prop.$areas){let a=this.prop.$areas[e];t+=renderBaseInfo(e,"swimlane",a),t+=' name="'+e+'" title="'+a.name+'"';let r="";for(let e in a)"left"!==e&&"top"!==e&&"width"!==e&&"height"!==e&&"name"!==e&&("object"==typeof a[e]?r+=json2XML(e,a[e],tab3):t+=" "+e+'="'+a[e]+'"');t+=""===r?"/>\n":">"+r+"\n"+tab2+"</swimlane>\n"}for(let e in this.prop.$memos){let a=this.prop.$memos[e];t+=renderBaseInfo(e,"memo",a),t+=">"+a.text+"\n"+tab2+"</memo>\n"}for(let a in this.prop.$nodes){let r=this.prop.$nodes[a],l=e[r.type]||r.type;t+=renderBaseInfo(a,l,r);let s="";for(let e in r)"left"===e||"top"===e||"width"===e||"height"===e||"type"===e||("areaId"===e&&null!=r.areaId?t+=' swimlane="'+r.areaId+'"':"object"==typeof r[e]?s+=json2XML(e,r[e],tab3):t+=" "+e+'="'+r[e]+'"');t+=""===s?"/>\n":">"+s+"\n"+tab2+"</"+l+">\n"}for(let e in this.prop.$lines){let a=this.prop.$lines[e];t+=tab2+'<sequenceFlow id="'+e+'" sourceRef="'+a.from+'" targetRef="'+a.to+'"';let r="";for(let e in a)"from"!==e&&"to"!==e&&("object"==typeof a[e]?r+=json2XML(e,a[e],tab3):t+=" "+e+'="'+a[e]+'"');t+=""===r?"/>\n":">"+r+"\n"+tab2+"</sequenceFlow>\n"}return t+=tab1+"</process>\n"+xmlEnd},loadBpmnXML(e,t){void 0===t&&(t={});let a={extra:{}};if("string"==typeof e){let t=e;window.ActiveXObject||"ActiveXObject"in window||navigator.userAgent.indexOf("Edge")>-1?(e=new ActivexObject("MSXML2.DOMDocument")).loadXML(t):e=(new DOMParser).parseFromString(t,"text/xml")}let r=e.getElementsByTagName("definitions")[0];a.extra.targetNamespace=r.getAttribute("targetNamespace");for(let e=0;e<r.childNodes.length;e++){let l=r.childNodes[e];if("string"==typeof l.data)continue;let s=l.tagName;if("process"!==s){if("initNum"===s){a.initNum=parseInt(l.textContent,10);continue}a.extra[s]={},l.childNodes.length>0&&"string"==typeof l.childNodes[0].data?a.extra[s]=l.childNodes[0].data:Xml2Json(l,a.extra[s])}else{a.extra.id=l.getAttribute("id"),a.title=l.getAttribute("name"),a.lines={},a.nodes={},a.areas={};for(let e=0;e<l.childNodes.length;++e){let r=l.childNodes[e];if("string"==typeof r.data)continue;let s=r.tagName,o=r.getAttribute("id");if("swimlane"===s){a.areas[o]={},Xml2Json(r,a.areas[o]),delete a.areas[o].id,a.areas[o].name=a.areas[o].title,delete a.areas[o].title;let e=a.areas[o].g.split(",");delete a.areas[o].g,a.areas[o].left=parseFloat(e[0]),a.areas[o].top=parseFloat(e[1]),a.areas[o].width=parseFloat(e[2]),a.areas[o].height=parseFloat(e[3])}else if("memo"===s){"object"!=typeof a.memos&&(a.memos={}),a.memos[o]={},Xml2Json(r,a.memos[o]),delete a.memos[o].id;let e=a.memos[o].g.split(",");delete a.memos[o].g,a.memos[o].left=parseFloat(e[0]),a.memos[o].top=parseFloat(e[1]),a.memos[o].width=parseFloat(e[2]),a.memos[o].height=parseFloat(e[3])}else if("sequenceFlow"===s)a.lines[o]={},Xml2Json(r,a.lines[o]),delete a.lines[o].id,a.lines[o].from=a.lines[o].sourceRef,a.lines[o].to=a.lines[o].targetRef,delete a.lines[o].sourceRef,delete a.lines[o].targetRef;else{a.nodes[o]={},Xml2Json(r,a.nodes[o]),delete a.nodes[o].id,void 0!==a.nodes[o].swimlane&&(a.nodes[o].areaId=a.nodes[o].swimlane,delete a.nodes[o].swimlane);let e=a.nodes[o].g.split(",");delete a.nodes[o].g,a.nodes[o].left=parseFloat(e[0]),a.nodes[o].top=parseFloat(e[1]),a.nodes[o].width=parseFloat(e[2]),a.nodes[o].height=parseFloat(e[3]),a.nodes[o].type=t[r.tagName]||r.tagName}}}}this.loadData(a)}}};