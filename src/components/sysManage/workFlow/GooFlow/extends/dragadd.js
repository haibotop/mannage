/**
 * GooFlow-Vue - Web端流程设计器
 * @author foolegg126 (sdlddr)
 * @version v1.2.0
 * @license Commercially licensed to 永凯软件技术(上海)有限公司-913101157867305734(imclouds)
 **/
import EventAgent from"../common/EventAgent";import Calc from"../common/Calc";export default{flag:"dragadd",methods:{_initDragAddOper(){if(!this.prop.$editable||!this.$refs.$tool)return;const t=this;EventAgent(this.$refs.$tool.$el,"mousedown","li",{},function(e,i){const h=i.getAttribute("type"),l=i.title;if(!t.prop.$dragAddOper)return;if("cursor"===h||"multi"===h||Calc.isDrawingLine(h))return;let r="";const a=Calc.getCoor(e,t.$refs.$workArea),d=t.prop.$nodeCustoms[h],p={width:104,height:26,type:h,title:null!=l&&""!==l?l:"--------",left:a.X,top:a.Y,canOver:!0};if(void 0!==d&&null!=d){d.width&&(p.width=d.width),d.height&&(p.height=d.height);const e='<i class="'+d.class+'" style="width:'+p.width+"px;height:"+p.height+'px;"></i>';r='<table cellspacing="0" style="width:'+p.width*t.scale+"px;height:"+p.height*t.scale+'px;margin:-1px"><tr><td class="ico">'+e+"</td></tr></table>"}else p.type.indexOf(" round")>-1?(p.width=26,p.height=26,p.title=""):p.type.indexOf(" rhomb")>0?(p.width=30,p.height=30,p.title=""):"group"===p.type?(p.width=200,p.height=100):"memo"===p.type?(p.width=140,p.height=54):r='<table cellspacing="1" style="width:'+(p.width*t.scale-2)+"px;height:"+(p.height*t.scale-2)+'px;"><tr><td class="ico"><i class="ico_'+p.type+'"></i></td><td><div>'+p.title+"</div></td></tr></table>";""===r&&(r='<table cellspacing="0" style="width:'+(p.width*t.scale-2)+"px;height:"+(p.height*t.scale-2)+'px;"><tr><td class="ico"><i class="ico_'+p.type+'"></i> '+p.title+"</td></tr></table>"),t.$refs.$ghost.setData("type",h),t.$refs.$ghost.html(r),t.$refs.$ghost.css({cursor:"move"}),t._bindMoveEvent(e,p,function(e,i,h,l,r){if(i.$refs.$ghost.removeData("type"),!(l<0||r<0)&&e){if("group"===p.type){i.switchToolBtn("group");const t=["red","yellow","blue","green","milk"];i.addArea((new Date).getTime(),{name:i.prop.$areaPrefix+i.prop.$max,left:l/i.scale,top:r/i.scale,color:t[i.prop.$max%5],width:200,height:100})}else"memo"===p.type?(i.switchToolBtn("memo"),i.addMemo((new Date).getTime(),{text:"",left:l/i.scale,top:r/i.scale,width:140,height:54})):(i.switchToolBtn("cursor"),t.addNode((new Date).getTime(),{name:i.prop.$nodePrefix+i.prop.$max,left:l/i.scale,top:r/i.scale,width:p.width,height:p.height,type:p.type}));i.prop.$max++}},"move",p.width,p.height)})}}};