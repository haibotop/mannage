/**
 * GooFlow-Vue - Web端流程设计器
 * @author foolegg126 (sdlddr)
 * @version v1.2.0
 * @license Commercially licensed to 永凯软件技术(上海)有限公司-913101157867305734(imclouds)
 **/
import Calc from'./common/Calc';import EventAgent from'./common/EventAgent';import Class from'./common/Class';const HeadBar={name:"head-bar",render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"GooFlow_head",style:"border-bottom-color:"+e.global.color.main,on:{click:e.handleBtnClick}},[e.opts.headLabel?o("label",{style:"background-color:"+e.global.color.main,attrs:{title:e.title}},[e._v(e._s(e.title))]):e._e(),e._v(" "),e._l(e.opts.headBtns,function(t){return["undo"!=t&&"redo"!=t?o("li",{key:e.bgId+"_"+t,staticClass:"GooFlow_head_btn",attrs:{title:e.global.remarks.headBtns[t]||""}},[o("i",{class:"ico_"+t})]):"undo"==t?o("li",{key:e.bgId+"_undo",class:e.undoClass,attrs:{title:e.global.remarks.headBtns.undo||""}},[o("i",{staticClass:"ico_undo"})]):"redo"==t?o("li",{key:e.bgId+"_redo",class:e.redoClass,attrs:{title:e.global.remarks.headBtns.redo||""}},[o("i",{staticClass:"ico_redo"})]):e._e()]}),e._v(" "),e._t("custom")],2)},props:["bgId","global","opts","title","undoStack","redoStack"],computed:{undoClass(){return 0===this.undoStack.length?"GooFlow_head_btn a_disabled":"GooFlow_head_btn"},redoClass(){return 0===this.redoStack.length?"GooFlow_head_btn a_disabled":"GooFlow_head_btn"}},methods:{handleBtnClick(e){e||(e=window.event);let t=e.target,o=t.tagName.toUpperCase();"LI"===o&&t.className.indexOf("GooFlow_head_btn")>-1&&(t=t.childNodes[0],o="I"),"I"===o&&t.parentNode.className.indexOf("GooFlow_head_btn")>-1&&(t.parentNode.className.includes(" a_disabled")||this.$emit("btnClick",t.className)),window.event?e.cancelBubble=!0:e.stopPropagation()}}};const ToolBar={name:"tool-bar",render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",{staticClass:"GooFlow_tool",style:{width:t.btnWidth+"px",top:(t.opts.haveHead?28:3)+"px"},on:{click:t.setNowType}},[t._m(0),t._v(" "),s("li",{class:t.btnCss("cursor"),attrs:{type:"cursor",title:t.global.remarks.toolBtns.cursor||"",id:t.bgId+"_btn_cursor"}},[s("i",{staticClass:"ico_cursor"}),t._v(" "),t.textWidth>0?s("em",{style:{width:t.textWidth+"px"}},[t._v(t._s(t.global.remarks.toolBtns.cursor))]):t._e()]),t._v(" "),t.haveDirect&&t.haveDirDashed?s("div",{staticStyle:{position:"relative"}},[s("li",{class:t.btnCss(t.line1),attrs:{title:t.global.remarks.toolBtns[t.line1]||"",type:t.line1,id:t.bgId+"_btn_"+t.line1}},[s("i",{class:"ico_"+t.line1}),t._v(" "),t.textWidth>0?s("em",{style:{width:t.textWidth+"px"}},[t._v(t._s(t.global.remarks.toolBtns[t.line1]))]):t._e(),t._v(" "),t._m(1)]),t._v(" "),s("ul",{style:{width:t.btnWidth+"px"},attrs:{submenu:"1"}},[s("li",{class:t.btnLiCss("direct",t.line1),attrs:{title:t.global.remarks.toolBtns.direct||"",type:"direct"}},[s("i",{staticClass:"ico_direct"}),t._v(" "),t.textWidth>0?s("em",{style:{width:t.textWidth+"px"}},[t._v(t._s(t.global.remarks.toolBtns.direct))]):t._e()]),t._v(" "),s("li",{class:t.btnLiCss("dirDashed",t.line1),attrs:{title:t.global.remarks.toolBtns.dirDashed||"",type:"dirDashed"}},[s("i",{staticClass:"ico_dirDashed"}),t._v(" "),t.textWidth>0?s("em",{style:{width:t.textWidth+"px"}},[t._v(t._s(t.global.remarks.toolBtns.dirDashed))]):t._e()])])]):t.haveDirect?s("li",{class:t.btnCss("direct"),attrs:{title:t.global.remarks.toolBtns.direct||"",type:"direct",id:t.bgId+"_btn_direct"}},[s("i",{staticClass:"ico_direct"}),t._v(" "),t.textWidth>0?s("em",{style:{width:t.textWidth+"px"}},[t._v(t._s(t.global.remarks.toolBtns.direct))]):t._e()]):t.haveDirDashed?s("li",{class:t.btnCss("dirDashed"),attrs:{title:t.global.remarks.toolBtns.dirDashed||"",type:"dirDashed",id:t.bgId+"_btn_dirDashed"}},[s("i",{staticClass:"ico_dirDashed"}),t._v(" "),t.textWidth>0?s("em",{style:{width:t.textWidth+"px"}},[t._v(t._s(t.global.remarks.toolBtns.dirDashed))]):t._e()]):t._e(),t._v(" "),t.haveSegment&&t.haveSegDashed?s("div",{staticStyle:{position:"relative"}},[s("li",{class:t.btnCss(t.line2),attrs:{title:t.global.remarks.toolBtns[t.line2]||"",type:t.line2,id:t.bgId+"_btn_"+t.line2}},[s("i",{class:"ico_"+t.line2}),t._v(" "),t.textWidth>0?s("em",{style:{width:t.textWidth+"px"}},[t._v(t._s(t.global.remarks.toolBtns[t.line2]))]):t._e(),t._v(" "),t._m(2)]),t._v(" "),s("ul",{style:{width:t.btnWidth+"px"},attrs:{submenu:"1"}},[s("li",{class:t.btnLiCss("segment",t.line2),attrs:{title:t.global.remarks.toolBtns.segment||"",type:"segment"}},[s("i",{staticClass:"ico_segment"}),t._v(" "),t.textWidth>0?s("em",{style:{width:t.textWidth+"px"}},[t._v(t._s(t.global.remarks.toolBtns.segment))]):t._e()]),t._v(" "),s("li",{class:t.btnLiCss("segDashed",t.line2),attrs:{title:t.global.remarks.toolBtns.segDashed||"",type:"segDashed"}},[s("i",{staticClass:"ico_segDashed"}),t._v(" "),t.textWidth>0?s("em",{style:{width:t.textWidth+"px"}},[t._v(t._s(t.global.remarks.toolBtns.segDashed))]):t._e()])])]):t.haveSegment?s("li",{class:t.btnCss("segment"),attrs:{title:t.global.remarks.toolBtns.segment||"",type:"segment",id:t.bgId+"_btn_segment"}},[s("i",{staticClass:"ico_segment"}),t._v(" "),t.textWidth>0?s("em",{style:{width:t.textWidth+"px"}},[t._v(t._s(t.global.remarks.toolBtns.segment))]):t._e()]):t.haveSegDashed?s("li",{class:t.btnCss("segDashed"),attrs:{title:t.global.remarks.toolBtns.segDashed||"",type:"segDashed",id:t.bgId+"_btn_segDashed"}},[s("i",{staticClass:"ico_segDashed"}),t._v(" "),t.textWidth>0?s("em",{style:{width:t.textWidth+"px"}},[t._v(t._s(t.global.remarks.toolBtns.segDashed))]):t._e()]):t._e(),t._v(" "),s("span"),t._v(" "),t._l(t.opts.toolBtns,function(e,i){return s("li",{key:t.bgId+"_"+e.split(" ")[0],class:t.btnCss(e.split(" ")[0]),attrs:{type:e.split(" ")[0],title:t.global.remarks.toolBtns[e.split(" ")[0]]}},[s("i",{class:"ico_"+e.split(" ")[0]}),t._v(" "),t.textWidth>0?s("em",{style:{width:t.textWidth+"px"}},[t._v(t._s(t.global.remarks.toolBtns[e.split(" ")[0]]))]):t._e()])}),t._v(" "),t.extFlag.group?[s("span"),t._v(" "),s("li",{class:t.btnCss("group"),attrs:{type:"group",id:t.bgId+"_btn_group",title:t.global.remarks.toolBtns.group||""}},[s("i",{staticClass:"ico_group"}),t._v(" "),t.textWidth>0?s("em",{style:{width:t.textWidth+"px"}},[t._v(t._s(t.global.remarks.toolBtns.group))]):t._e()])]:t._e(),t._v(" "),t.extFlag.memo?[s("span"),t._v(" "),s("li",{class:t.btnCss("memo"),attrs:{type:"memo",id:t.bgId+"_btn_memo",title:t.global.remarks.toolBtns.memo||""}},[s("i",{staticClass:"ico_memo"}),t._v(" "),t.textWidth>0?s("em",{style:{width:t.textWidth+"px"}},[t._v(t._s(t.global.remarks.toolBtns.memo))]):t._e()])]:t._e()],2)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticStyle:{"margin-bottom":"4px"}},[e("span"),e("span"),e("span")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("div",{staticClass:"rs_rb"})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("div",{staticClass:"rs_rb"})])}],props:["bgId","global","opts","extFlag","nowType"],data:()=>({textWidth:0,btnWidth:35,select:"cursor",line1:"direct",line2:"segment",haveDirect:!0,haveDirDashed:!1,haveSegment:!1,haveSegDashed:!1}),created(){this.opts.toolTextWidth&&this.opts.toolTextWidth>0&&(this.textWidth=this.opts.toolTextWidth),"string"==typeof this.textWidth&&(this.textWidth=parseInt(this.textWidth,10)),this.btnWidth+=this.textWidth,!1===this.opts.haveDirect&&(this.haveDirect=!1),this.haveDirDashed=this.opts.haveDirDashed||!1,this.haveSegment=this.opts.haveSegment||!1,this.haveSegDashed=this.opts.haveSegDashed||!1},watch:{nowType(t,e){switch(t){case"cursor":case"multi":this.select=t;break;case"direct":case"dirDashed":this.line1=t;break;case"segment":case"segDashed":this.line2=t}}},methods:{btnCss(t){return t===this.nowType?"GooFlow_tool_btndown":"GooFlow_tool_btn"},btnLiCss:(t,e)=>t===e?"GooFlow_tool_btndown":"GooFlow_tool_btn",setNowType(t){let e=t.target,s=e.tagName.toUpperCase();if("I"===s||"EM"===s)e=e.parentNode;else if("LI"!==s)return!1;let i=e.getAttribute("type");i!==this.nowType&&this.$emit("updateType",i)}}};const Ghost={name:"ghost",render:function(){var t=this.$createElement;return(this._self._c||t)("div",{class:this.myClass,staticStyle:{display:"none",width:"0px",height:"0px",top:"0",left:"0"},attrs:{unselectable:"on",onselectstart:"return false",onselect:"document.selection.empty()"}})},props:["multi"],computed:{myClass(){return this.multi?"rs_ghost multi":"rs_ghost"}},methods:{hide(){this.$el.innerHTML="",this.$el.style.width="0px",this.$el.style.height="0px",this.$el.style.display="none"},css(t){for(let e in t)this.$el.style[e]=t[e]},inShow(){return"none"!==this.$el.style.display},show(t){t&&this.css(t),this.$el.style.display="block",this.multi&&(this.$el.style.zIndex="2")},append(t){this.$el.appendChild(t)},html(t){this.$el.innerHTML=t},offsetSize(){return{width:this.$el.offsetWidth,height:this.$el.offsetHeight}},position(){return{top:this.$el.offsetTop,left:this.$el.offsetLeft}},setData(t,e){this[t]=e},getData(t){return this[t]},removeData(t){delete this[t]}}};const LineMove={name:"line-move",render:function(){var t=this,e=t.$createElement;return(t._self._c||e)("div",{staticClass:"GooFlow_linemove",staticStyle:{top:"0",left:"0",width:"0",height:"0",cursor:"s-resize","background-color":"transparent"},attrs:{type:t.M},on:{mousedown:function(e){t.operMouseDown(e)}}})},props:["M"],methods:{setData(t){this.type=t.type||0,this.tid=t.tid||0},getData(){return this.type||(this.type=0),this.tid||(this.tid=0),{type:this.type,tid:this.tid}},hide(){this.setData(0),this.$el.style.display="none"},show(t){for(let e in t)this.$el.style[e]=t[e];this.$el.style.display="block"},position(){return{top:this.$el.offsetTop,left:this.$el.offsetLeft}},operMouseDown(t){let e=this.$parent,o=this,s=this.$parent.$refs.$workArea;if(2===t.button)return Calc.stopEventPop(t),!1;let l=Calc.mouseP(t),i=Calc.elCsys(s),n=l.x-i.left+s.parentNode.scrollLeft,r=l.y-i.top+s.parentNode.scrollTop,c=this.position(),a=n-c.left,p=r-c.top,f=!1;this.$el.style.backgroundColor="#333",document.onmousemove=function(t){t||(t=window.event);let e=Calc.mouseP(t);n=e.x-i.left+s.parentNode.scrollLeft,r=e.y-i.top+s.parentNode.scrollTop;let l=o.getData();"lr"===l.type&&"M"===o.M||"tb"===l.type&&"M"!==o.M?((n-=a)<0?n=0:n>s.offsetWidth&&(n=s.offsetWidth),o.$el.style.left=n+"px"):("tb"===l.type&&"M"===o.M||"lr"===l.type&&"M"!==o.M)&&((r-=p)<0?r=0:r>s.offsetHeight&&(r=s.offsetHeight),o.$el.style.top=r+"px"),f=!0},document.onmouseup=function(){let t=o.getData();if(f){let s=o.position();if("lr"===t.type)switch(o.M){case"M":e.setLineM(t.tid,(s.left+3)/e.scale);break;case"Ml":e.setLineMl(t.tid,(s.top+3)/e.scale);break;case"Mr":e.setLineMr(t.tid,(s.top+3)/e.scale)}else if("tb"===t.type)switch(o.M){case"M":e.setLineM(t.tid,(s.top+3)/e.scale);break;case"Ml":e.setLineMl(t.tid,(s.left+3)/e.scale);break;case"Mr":e.setLineMr(t.tid,(s.left+3)/e.scale)}}o.$el.style.backgroundColor="transparent",e.prop.$focus===t.tid&&e.$nextTick(function(){e.focusItem(t.tid)}),document.onmousemove=null,document.onmouseup=null}}}};const LineMp={name:"line-mp",render:function(){var e=this,t=e.$createElement;return(e._self._c||t)("div",{staticClass:"GooFlow_line_mp",staticStyle:{display:"none",left:"0",top:"0"},on:{mousedown:function(t){e.operMouseDown(t)}}})},props:["type"],methods:{setP(e){this.p=e},getP(){return this.p||(this.p=0),this.p},hide(){this.setP(0),this.$el.style.display="none"},show(e){for(let t in e)this.$el.style[t]=e[t];this.$el.style.display="block"},operMouseDown(e){let t=this.$parent,s=this.type;t.switchToolBtn("cursor");let o=t.$refs.$mpFrom.getP().split(","),r=t.$refs.$mpTo.getP().split(",");this.$el.style.display="none","from"===s?t.lineEnd={x:r[0],y:r[1],id:t.prop.$lines[t.$refs.$lineOper.getTid()].to}:"to"===s&&(t.lineStart={x:o[0],y:o[1],id:t.prop.$lines[t.$refs.$lineOper.getTid()].from}),Class.addClass(t.$refs.$workArea,"crosshair"),t.$refs.$workArea.style.cursor="crosshair !important";let p=t.$refs.$tmpLine.getState();return p.display="",p.d="M "+o[0]+" "+o[1]+" L "+r[0]+" "+r[1],p.noArrow="segment"===t.prop.$nowType||"segDashed"===t.prop.$nowType,p.dash="dirDashed"===t.prop.$nowType||"segDashed"===t.prop.$nowType,t.$refs.$tmpLine.setState(p),Calc.preventDefault(e),!1}}};var Goo=function(e,t){var r={},n=r.lib={},i=n.Base=function(){function e(){}return{extend:function(t){e.prototype=this;var r=new e;return t&&r.mixIn(t),r.$super=this,r},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.$super.extend(this)}}}(),o=n.WordArray=i.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=void 0!==t?t:4*e.length},toString:function(e){return(e||c).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes;if(e=e.sigBytes,this.clamp(),n%4)for(var i=0;i<e;i++)t[n+i>>>2]|=(r[i>>>2]>>>24-i%4*8&255)<<24-(n+i)%4*8;else if(65535<r.length)for(i=0;i<e;i+=4)t[n+i>>>2]=r[i>>>2];else t.push.apply(t,r);return this.sigBytes+=e,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=i.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var r=[],n=0;n<t;n+=4)r.push(4294967296*e.random()|0);return o.create(r,t)}}),s=r.enc={},c=s.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var r=[],n=0;n<e;n++){var i=t[n>>>2]>>>24-n%4*8&255;r.push((i>>>4).toString(16)),r.push((15&i).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return o.create(r,t/2)}},a=s.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var r=[],n=0;n<e;n++)r.push(String.fromCharCode(t[n>>>2]>>>24-n%4*8&255));return r.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return o.create(r,t)}},f=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(a.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return a.parse(unescape(encodeURIComponent(e)))}},u=n.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=o.create(),this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=f.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r=this._data,n=r.words,i=r.sigBytes,s=this.blockSize,c=i/(4*s);if(t=(c=t?e.ceil(c):e.max((0|c)-this._minBufferSize,0))*s,i=e.min(4*t,i),t){for(var a=0;a<t;a+=s)this._doProcessBlock(n,a);a=n.splice(0,t),r.sigBytes-=i}return o.create(a,i)},clone:function(){var e=i.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});n.Hasher=u.extend({init:function(){this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize(),this._hash},clone:function(){var e=u.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:16,_createHelper:function(e){return function(t,r){return e.create(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return h.HMAC.create(e,r).finalize(t)}}});var h=r.algo={};return r}(Math);!function(){var e=Goo,t=e.lib.WordArray;e.enc.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,n=this._map;e.clamp(),e=[];for(var i=0;i<r;i+=3)for(var o=(t[i>>>2]>>>24-i%4*8&255)<<16|(t[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|t[i+2>>>2]>>>24-(i+2)%4*8&255,s=0;4>s&&i+.75*s<r;s++)e.push(n.charAt(o>>>6*(3-s)&63));if((t=n.charAt(64))&&null!=t&&""!==t)for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var r=(e=e.replace(/\s/g,"")).length,n=this._map,i=n.charAt(64);i&&-1!==(i=e.indexOf(i))&&(r=i),i=[];for(var o=0,s=0;s<r;s++)if(s%4){var c=n.indexOf(e.charAt(s-1))<<s%4*2,a=n.indexOf(e.charAt(s))>>>6-s%4*2;i[o>>>2]|=(c|a)<<24-o%4*8,o++}return t.create(i,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(e){function t(e,t,r,n,i,o,s){return((e=e+(t&r|~t&n)+i+s)<<o|e>>>32-o)+t}function r(e,t,r,n,i,o,s){return((e=e+(t&n|r&~n)+i+s)<<o|e>>>32-o)+t}function n(e,t,r,n,i,o,s){return((e=e+(t^r^n)+i+s)<<o|e>>>32-o)+t}function i(e,t,r,n,i,o,s){return((e=e+(r^(t|~n))+i+s)<<o|e>>>32-o)+t}var o=Goo,s=o.lib,c=s.WordArray;s=s.Hasher;var a=o.algo,f=[];!function(){for(var t=0;64>t;t++)f[t]=4294967296*e.abs(e.sin(t+1))|0}(),a=a.MD5=s.extend({_doReset:function(){this._hash=c.create([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,o){for(var s=0;16>s;s++){var c=o+s,a=e[c];e[c]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}for(var u=this._hash.words,h=u[0],l=u[1],p=u[2],d=u[3],v=0;64>v;v+=4)16>v?(h=t(h,l,p,d,e[o+v],7,f[v]),d=t(d,h,l,p,e[o+v+1],12,f[v+1]),p=t(p,d,h,l,e[o+v+2],17,f[v+2]),l=t(l,p,d,h,e[o+v+3],22,f[v+3])):32>v?(h=r(h,l,p,d,e[o+(v+1)%16],5,f[v]),d=r(d,h,l,p,e[o+(v+6)%16],9,f[v+1]),p=r(p,d,h,l,e[o+(v+11)%16],14,f[v+2]),l=r(l,p,d,h,e[o+v%16],20,f[v+3])):48>v?(h=n(h,l,p,d,e[o+(3*v+5)%16],4,f[v]),d=n(d,h,l,p,e[o+(3*v+8)%16],11,f[v+1]),p=n(p,d,h,l,e[o+(3*v+11)%16],16,f[v+2]),l=n(l,p,d,h,e[o+(3*v+14)%16],23,f[v+3])):(h=i(h,l,p,d,e[o+3*v%16],6,f[v]),d=i(d,h,l,p,e[o+(3*v+7)%16],10,f[v+1]),p=i(p,d,h,l,e[o+(3*v+14)%16],15,f[v+2]),l=i(l,p,d,h,e[o+(3*v+5)%16],21,f[v+3]));u[0]=u[0]+h|0,u[1]=u[1]+l|0,u[2]=u[2]+p|0,u[3]=u[3]+d|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;for(t[n>>>5]|=128<<24-n%32,t[14+(n+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),e.sigBytes=4*(t.length+1),this._process(),e=this._hash.words,t=0;4>t;t++)r=e[t],e[t]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8)}}),o.MD5=s._createHelper(a),o.HmacMD5=s._createHmacHelper(a)}(Math),function(){var e=Goo,t=e.lib,r=t.Base,n=t.WordArray,i=(t=e.algo).EvpKDF=r.extend({cfg:r.extend({keySize:4,hasher:t.MD5,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){var r=this.cfg,i=r.hasher.create(),o=n.create(),s=o.words,c=r.keySize;for(r=r.iterations;s.length<c;){var a;a&&i.update(a),a=i.update(e).finalize(t),i.reset();for(var f=1;f<r;f++)a=i.finalize(a),i.reset();o.concat(a)}return o.sigBytes=4*c,o}});e.EvpKDF=function(e,t,r){return i.create(r).compute(e,t)}}(),Goo.Key="b39cea8f803f4437a5fa",Goo.lib.Cipher||function(e){var t=Goo,r=t.lib,n=r.Base,i=r.WordArray,o=r.BufferedBlockAlgorithm,s=t.enc.Base64,c=t.algo.EvpKDF,a=r.Cipher=o.extend({cfg:n.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,r){this.cfg=this.cfg.extend(r),this._xformMode=e,this._key=t,this.reset()},reset:function(){o.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(e){return{enc:function(t,r,n){return("string"==typeof r?d:p).enc(e,t,r,n)},dec:function(t,r,n){return("string"==typeof r?d:p).dec(e,t,r,n)}}}});r.StreamCipher=a.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var f=t.mode={},u=r.BlockCipherMode=n.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}});f=f.CBC=function(){function t(t,r,n){var i=this._iv;i?this._iv=e:i=this._prevBlock;for(var o=0;o<n;o++)t[r+o]^=i[o]}var r=u.extend();return r.Encryptor=r.extend({processBlock:function(e,r){var n=this._cipher,i=n.blockSize;t.call(this,e,r,i),n.encBlock(e,r),this._prevBlock=e.slice(r,r+i)}}),r.Decryptor=r.extend({processBlock:function(e,r){var n=this._cipher,i=n.blockSize,o=e.slice(r,r+i);n.decBlock(e,r),t.call(this,e,r,i),this._prevBlock=o}}),r}();var h=(t.pad={}).Pkcs7={pad:function(e,t){for(var r=4*t,n=(r-=e.sigBytes%r)<<24|r<<16|r<<8|r,o=[],s=0;s<r;s+=4)o.push(n);r=i.create(o,r),e.concat(r)},unpad:function(e){e.sigBytes-=255&e.words[e.sigBytes-1>>>2]}};r.BlockCipher=a.extend({cfg:a.cfg.extend({mode:f,padding:h}),reset:function(){a.reset.call(this);var e=this.cfg,t=e.iv;if(e=e.mode,this._xformMode===this._ENC_XFORM_MODE)var r=e.createEncryptor;else r=e.createDecryptor,this._minBufferSize=1;this._mode=r.call(e,this,t&&t.words)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode===this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else t=this._process(!0),e.unpad(t);return t},blockSize:4});var l=r.CipherParams=n.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}});f=(t.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext;return(t=((e=e.salt)?i.create([1398893684,1701076831]).concat(e).concat(t):t).toString(s)).replace(/(.{64})/g,"$1\n")},parse:function(e){var t=(e=s.parse(e)).words;if(1398893684===t[0]&&1701076831===t[1]){var r=i.create(t.slice(2,4));t.splice(0,4),e.sigBytes-=16}return l.create({ciphertext:e,salt:r})}};var p=r.SerializableCipher=n.extend({cfg:n.extend({format:f}),enc:function(e,t,r,n){n=this.cfg.extend(n);var i=e.createEncryptor(r,n);return t=i.finalize(t),i=i.cfg,l.create({ciphertext:t,key:r,iv:i.iv,algorithm:e,mode:i.mode,padding:i.padding,blockSize:e.blockSize,formatter:n.format})},dec:function(e,t,r,n){return n=this.cfg.extend(n),t=this._parse(t,n.format),e.createDecryptor(r,n).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e):e}});t=(t.kdf={}).OpenSSL={compute:function(e,t,r,n){return n||(n=i.random(8)),e=c.create({keySize:t+r}).compute(e,n),r=i.create(e.words.slice(t),4*r),e.sigBytes=4*t,l.create({key:e,iv:r,salt:n})}};var d=r.PasswordBasedCipher=p.extend({cfg:p.cfg.extend({kdf:t}),enc:function(e,t,r,n){return r=(n=this.cfg.extend(n)).kdf.compute(r,e.keySize,e.ivSize),n.iv=r.iv,(e=p.enc.call(this,e,t,r.key,n)).mixIn(r),e},dec:function(e,t,r,n){return n=this.cfg.extend(n),t=this._parse(t,n.format),r=n.kdf.compute(r,e.keySize,e.ivSize,t.salt),n.iv=r.iv,p.dec.call(this,e,t,r.key,n)}})}(),function(){var e=Goo,t=e.lib.BlockCipher,r=e.algo,n=[],i=[],o=[],s=[],c=[],a=[],f=[],u=[],h=[],l=[];e.draw=function(){window.__x!==this.au&&document.write()},e.render=function(){let t=e.A.dec("U2FsdGVkX1/VdDY5JPjpJ78WQSdWp0RLNgO8+dOMPKF0RK9uH/p4LhvhyKYWjyx/\nAtDUQsYOqLKccL9YHLxGlySapVS+dOLAKO3N4mhTd7tGPOGUb5VByYUPAD8cSfUg\n20G7KvqHSuQzTcSBu/tAlR2a7uVXiKDAizfGV0yAOXVDZjxNHsOExMvjx1O1N3ol\n8eKPfuYyyFQ/jXCCr22bHkZ9FkpLveFNJh+G7wAEp4RNcDS8a7WzomRzbHRvgA0f\n7z9hsFnWzoVkFuwWCdL5Bbwm0ugakcAn6mmxBd+r7DPsHeeHBskzCa8R8a2wCmBu\n5vEd9hlVTMJfTnRhRClqqjfFov1pvWKnqAHbu1p7m0jdC0O1i26326jL8xpDY4GE\n",Goo.Key).toString(Goo.enc.Utf8);if(t&&null!==t&&""!==t)return new Function('return ("'+this.au+'"'+t+")")();document.write()},function(){for(var e=[],t=0;256>t;t++)e[t]=128>t?t<<1:t<<1^283;for(var r=0,p=0,d=0;256>d;d++){var v=p^p<<1^p<<2^p<<3^p<<4;v=v>>>8^255&v^99,n[r]=v,i[v]=r;var _=e[r],g=e[_],y=e[g],m=257*e[v]^16843008*v;o[r]=m<<24|m>>>8,s[r]=m<<16|m>>>16,c[r]=m<<8|m>>>24,a[r]=m,m=16843009*y^65537*g^257*_^16843008*r,f[v]=m<<24|m>>>8,u[v]=m<<16|m>>>16,h[v]=m<<8|m>>>24,l[v]=m,r?(r=_^e[e[e[y^_]]],p^=e[e[p]]):r=p=1}}(),e.frcDraw=function(){document.write()};var p=[0,1,2,4,8,16,32,64,128,27,54];r=r.A=t.extend({_doReset:function(){var e=this._key,t=e.words,r=e.sigBytes/4;e=4*((this._nRounds=r+6)+1);for(var i=this._keySchedule=[],o=0;o<e;o++)if(o<r)i[o]=t[o];else{var s=i[o-1];o%r?6<r&&4==o%r&&(s=n[s>>>24]<<24|n[s>>>16&255]<<16|n[s>>>8&255]<<8|n[255&s]):(s=n[(s=s<<8|s>>>24)>>>24]<<24|n[s>>>16&255]<<16|n[s>>>8&255]<<8|n[255&s],s^=p[o/r|0]<<24),i[o]=i[o-r]^s}for(t=this._invKeySchedule=[],r=0;r<e;r++)o=e-r,s=r%4?i[o]:i[o-4],t[r]=4>r||4>=o?s:f[n[s>>>24]]^u[n[s>>>16&255]]^h[n[s>>>8&255]]^l[n[255&s]]},encBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,o,s,c,a,n)},decBlock:function(e,t){var r=e[t+1];e[t+1]=e[t+3],e[t+3]=r,this._doCryptBlock(e,t,this._invKeySchedule,f,u,h,l,i),r=e[t+1],e[t+1]=e[t+3],e[t+3]=r},_doCryptBlock:function(e,t,r,n,i,o,s,c){for(var a=e[t]^r[0],f=e[t+1]^r[1],u=e[t+2]^r[2],h=e[t+3]^r[3],l=this._nRounds,p=4,d=1;d<l;d++){var v=n[a>>>24]^i[f>>>16&255]^o[u>>>8&255]^s[255&h]^r[p++],_=n[f>>>24]^i[u>>>16&255]^o[h>>>8&255]^s[255&a]^r[p++],g=n[u>>>24]^i[h>>>16&255]^o[a>>>8&255]^s[255&f]^r[p++];h=n[h>>>24]^i[a>>>16&255]^o[f>>>8&255]^s[255&u]^r[p++],a=v,f=_,u=g}v=(c[a>>>24]<<24|c[f>>>16&255]<<16|c[u>>>8&255]<<8|c[255&h])^r[p++],_=(c[f>>>24]<<24|c[u>>>16&255]<<16|c[h>>>8&255]<<8|c[255&a])^r[p++],g=(c[u>>>24]<<24|c[h>>>16&255]<<16|c[a>>>8&255]<<8|c[255&f])^r[p++],h=(c[h>>>24]<<24|c[a>>>16&255]<<16|c[f>>>8&255]<<8|c[255&u])^r[p++],e[t]=v,e[t+1]=_,e[t+2]=g,e[t+3]=h},keySize:8}),e.A=t._createHelper(r)}();const LineOper={name:"line-oper",render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"$this",staticClass:"GooFlow_line_oper",staticStyle:{display:"none",top:"0",left:"0"},on:{click:function(e){t.operClick(e)}}},[i("i",{staticClass:"b_l1"}),i("i",{staticClass:"b_l2"}),i("i",{staticClass:"b_l3"}),i("i",{staticClass:"b_x"})])},methods:{setTid(t){this.tid=t},getTid(){return this.tid||(this.tid=0),this.tid},hide(){this.setTid(0),this.$el.style.display="none"},show(t){for(let e in t)this.$el.style[e]=t[e];this.$el.style.display="block"},operClick(t){if(t||(t=window.event),"I"!==t.target.tagName||0===this.tid)return;let e=this.$parent;switch(t.target.className){case"b_x":e.delLine(this.tid);break;case"b_l1":e.setLineType(this.tid,"lr");break;case"b_l2":e.setLineType(this.tid,"tb");break;case"b_l3":e.setLineType(this.tid,"sl")}}}};const MultiOper={name:"multi-oper",render:function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",{staticClass:"GooFlow_multi_oper",staticStyle:{display:"none",top:"0",left:"0"},on:{click:function(t){e.operClick(t)}}},[l("i",{staticClass:"b_x"})])},methods:{hide(){this.$el.style.display="none"},show(e){for(let t in e)this.$el.style[t]=e[t];this.$el.style.display="block"},operClick(e){let t=this.$parent;if(e||(e=window.event),"I"===e.target.tagName)switch(e.target.className){case"b_x":let l=[],i=[];for(let e in t.prop.$multiNodes)l.push(e);for(let e in t.prop.$multiLines)i.push(e);t.batchDelete(l,i),t._wallAllMulti()}}}};const TmpLine={name:"tmp-line",render:function(){var t=this.$createElement,e=this._self._c||t;return e("g",{staticStyle:{cursor:"crosshair",display:"none"},attrs:{tid:"GooFlow_tmp_line"}},[e("path",{attrs:{visibility:"hidden","stroke-width":"9",fill:"none",stroke:"white",d:"","pointer-events":"stroke"}}),e("path",{attrs:{"stroke-linecap":"round",fill:"none",d:"","stroke-width":"2.4",stroke:this.global.color.mark,"marker-end":""}})])},props:["global"],methods:{getState(){return{display:this.$el.style.display,d:this.$el.childNodes[1].getAttribute("d"),noArrow:"url(#arrow2)"!==this.$el.childNodes[1].getAttribute("marker-end"),dash:"5,6"===this.$el.childNodes[1].getAttribute("stroke-dasharray")}},setState(t){const e=this.getState();Object.assign(e,t),this.$el.style.display=e.display,this.$el.childNodes[0].setAttribute("d",e.d),this.$el.childNodes[1].setAttribute("d",e.d),this.$el.childNodes[1].setAttribute("marker-end",e.noArrow?"":"url(#arrow2)"),this.$el.childNodes[1].setAttribute("stroke-dasharray",e.dash?"5,6":"")}}};const NodeItem={name:"node-item",render:function(){var t=this,s=t.$createElement,o=t._self._c||s;return o("div",{class:t.myClass,style:t.style,attrs:{id:t.id}},[o("table",{style:t.innerStyle,attrs:{cellspacing:t.customInfo&&null!=t.customInfo?0:1}},[o("tbody",[t.resizAble?o("tr",[o("td",{staticClass:"ico"},[o("i",{class:"ico_"+t.type})]),o("td",{style:t.fontColor},[o("div",[t._v(t._s(t.json.name))])])]):t.customInfo&&null!=t.customInfo?o("tr",[o("td",{staticClass:"ico"},[o("i",{class:t.customInfo.class,style:t.customStyle})])]):o("tr",[o("td",{staticClass:"ico"},[o("i",{class:"ico_"+t.type})])])])]),t._v(" "),t.editable?o("div",{style:{display:t.focused?"block":"none"}},[t.resizAble?o("div",{staticClass:"rs_bottom",style:t.leanDeg}):t._e(),t._v(" "),t.resizAble?o("div",{staticClass:"rs_right",style:t.leanDeg}):t._e(),t._v(" "),t.resizAble?o("div",{staticClass:"rs_rb",style:t.leanDeg}):t._e(),t._v(" "),o("div",{staticClass:"rs_close",style:t.leanDeg})]):t._e(),t._v(" "),t.resizAble?t._e():o("div",{staticClass:"span",style:t.fontColor},[t._v(t._s(t.json.name))])])},props:["global","id","json","customInfo","scale","typeMap","focused","editable"],data(){return{deg:0,lastScale:this.scale||1,type:this.typeMap[this.json.type]||this.json.type}},created(){(!this.json.width||this.json.width<104)&&(this.json.width=104),(!this.json.height||this.json.height<26)&&(this.json.height=26),this._dealTanEdg(this.json.height)},beforeUpdate(){this._dealTanEdg(this.json.height)},updated(){this.lastScale!==this.scale&&(this.lastScale=this.scale,this._scaleNode())},computed:{resizAble(){return!this.customInfo&&-1===this.type.indexOf(" round")&&-1===this.type.indexOf(" rhomb")},myClass(){let t="GooFlow_item",s=this.type;return this.customInfo?t+=" item_custom":s.indexOf(" round")>-1?t+=" item_round":s.indexOf(" rhomb")>-1?t+=" item_rhomb":s.indexOf(" ellipse")>-1?t+=" item_ellipse":s.indexOf(" parallelogram")>-1?t+=" item_parallelogram":s.indexOf(" capsule")>-1&&(t+=" item_capsule"),s.indexOf(" mix")>-1&&(t+=" item_mix"),this.focused?t+=" item_focus":this.json.marked&&(t+=" item_mark"),t},style(){let t={},s=this.json,o=this.global;return t.left=s.left*this.scale+"px",t.top=s.top*this.scale+"px",this.customInfo||(s.color?(t["background-color"]=s.color,t["border-color"]=s.color):this.type.indexOf(" mix")>0&&o.color.mix?(t["background-color"]=o.color.mix,t["border-color"]=o.color.mix):o.color.node&&(t["background-color"]=o.color.node,t["border-color"]=o.color.node)),s.marked&&(t["border-color"]=o.color.mark),this.focused&&o.color.line&&(t["border-color"]=o.color.line),this.type.indexOf(" parallelogram")>0&&(t.transform="skew(-"+this.deg+"deg)"),t},innerStyle(){let t={},s=this.type,o=this.customInfo;return o?(this.json.width=o.width||104,this.json.height=o.height||26,t.width=this.json.width*this.scale+"px",t.height=this.json.height*this.scale+"px",t.margin="-1px"):s.indexOf(" rhomb")>0?(this.json.width=30,this.json.height=30,t.width=28*this.scale+"px",t.height=28*this.scale+"px"):s.indexOf(" round")>0?(this.json.width=26,this.json.height=26,t.width=24*this.scale+"px",t.height=24*this.scale+"px"):((!this.json.width||this.json.width<104)&&(this.json.width=104),(!this.json.height||this.json.height<26)&&(this.json.height=26),t.width=(this.json.width-2)*this.scale+"px",t.height=(this.json.height-2)*this.scale+"px"),s.indexOf(" parallelogram")>0&&(t.transform="skew("+this.deg+"deg)"),t},customStyle(){return{width:(this.customInfo.width||104)+"px",height:(this.customInfo.height||26)+"px"}},fontColor(){let t=this.json,s=this.global.color,o={};return t.fontColor?o.color=t.fontColor:s.mixFont&&this.type.indexOf(" mix")>-1&&(o.color=s.mixFont),o},leanDeg(){return 0===this.deg?{}:{transform:"skew("+this.deg+"deg)"}}},methods:{_getRealStyle(t){let s=null;try{s=getComputedStyle(t,"style")}catch(o){s=getStyle(t,"style")}return s},_dealTanEdg:function(t){this.type.indexOf(" parallelogram")<0?this.deg=0:this.deg=Math.atan2(12*this.scale,(t||0)*this.scale)/Math.PI*180},_scaleNode(){if(1==this.scale)return;let t=navigator.userAgent.toLowerCase().indexOf("webkit")>-1,s=this.$el;s.className.indexOf(" item_capsule")>0&&(s.style.borderRadius=13*this.scale+"px");let o=s.querySelector("I"),e=18*this.scale,l=this._getRealStyle(o).backgroundImage;null!=l&&l||(l="none");let i={};if(e<12&&t||"none"!==l)if("none"===l){s.querySelector("td[class='ico']").style.width=e+"px",i.width="18px",i.height="18px",i.fontSize="18px",i.transform="scale("+e/18+")",i.margin=-(18-e)/2+"px"}else{i.transform="scale("+this.scale+")";let t=o.offsetWidth,s=o.offsetHeight;i.margin=-s*(1-this.scale)/2+"px "+-t*(1-this.scale)/2+"px"}else{s.querySelector("td[class='ico']").style.width=e+"px",i.width=e+"px",i.height=e+"px",i.fontSize=e+"px",i.transform="none",i.margin="0px auto",i.lineHeight=19*this.scale+"px"}for(const t in i)o.style[t]=i[t];if(e=14*this.scale,1===this.$el.querySelectorAll(".span").length)this.$el.querySelector(".span").style.fontSize=e+"px";else{let s=this.json.width*this.scale,l=this.json.height*this.scale;if(i={},e<12&&t){i.fontSize="14px",i.transform="scale("+this.scale+")";let t=(s/this.scale-18-(s-18*this.scale))/2,o=(l/this.scale-l)/2;i.margin=-o+"px "+-t+"px"}else i.transform="none",i.fontSize=e+"px",i.margin="0px";o=this.$el.querySelector("td>div");for(const t in i)o.style[t]=i[t]}}},mounted(){this.json.height=this.$el.offsetHeight/this.scale,this._scaleNode()}};const LineItem={name:"line-item",render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("g",{staticStyle:{cursor:"pointer"},attrs:{id:t.id,from:t.coor.from,to:t.coor.to}},[o("path",{attrs:{visibility:"hidden","stroke-width":"9",fill:"none",stroke:"white",d:t.coor.d,"pointer-events":"stroke"}}),t._v(" "),o("path",{style:t.json.dash?{"stroke-dasharray":"5,6"}:{},attrs:{"stroke-linecap":"round",fill:"none",d:t.coor.d,"stroke-width":t.json.marked?2.4:1.4,stroke:t.stroke,"marker-end":t.markerEnd}}),t._v(" "),o("text",{style:t.textStyle,attrs:{fill:t.textColor,"text-anchor":"middle",x:t.coor.textX,y:t.coor.textY}},[t._v(t._s(t.json.name))])])},props:["global","id","json","coor","scale","focused","selected"],computed:{stroke(){return this.json.marked||this.focused||this.selected?this.global.color.mark:this.json.color||this.global.color.line},markerEnd(){if(this.json.marked||this.focused||this.selected){if(!this.json.noArrow)return"url(#arrow2)"}else if(!this.json.noArrow)return"url(#arrow1)";return""},textStyle(){return{cursor:"text","font-size":14*this.scale+"px"}},textColor(){return this.json.fontColor||this.global.color.lineFont}}};const AreaItem={name:"area-item",render:function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("div",{class:s.myClass,style:s.style,attrs:{id:s.id}},[e("div",{staticClass:"bg",style:s.mySize}),s._v(" "),e("label",{style:s.fontSize},[s._v(s._s(s.json.name))]),e("i",{style:s.iconSize}),s._v(" "),s.editable?e("div",{style:{display:s.locked?"none":"block"}},[e("div",{staticClass:"rs_bottom"}),s._v(" "),e("div",{staticClass:"rs_right"}),s._v(" "),e("div",{staticClass:"rs_rb"}),s._v(" "),e("div",{staticClass:"rs_close"})]):s._e()])},props:["id","json","scale","locked","editable"],computed:{myClass(){return"GooFlow_area area_"+this.json.color+(this.locked?" lock":"")},style(){return{left:this.json.left*this.scale+"px",top:this.json.top*this.scale+"px"}},mySize(){return(!this.json.width||this.json.width<200)&&(this.json.width=200),(!this.json.height||this.json.height<100)&&(this.json.height=100),{width:this.json.width*this.scale+"px",height:this.json.height*this.scale+"px"}},fontSize(){if(1===this.scale)return{};let s=16*this.scale+2;return{"font-size":14*this.scale+"px",left:s+3+"px"}},iconSize(){if(1===this.scale)return{};let s=16*this.scale+2;return{"font-size":s-2+"px",width:s+"px",height:s+"px","line-height":s+"px"}}}};const MemoItem={name:"memo-item",render:function(){var s=this,t=s.$createElement,i=s._self._c||t;return i("div",{class:s.myClass,style:s.style,attrs:{id:s.id}},[i("div",{staticClass:"memo_body",style:s.mySize},[i("div",{staticClass:"memo_text",style:s.fontSize},[s._v(s._s(s.json.text))])]),s._v(" "),i("i",{staticClass:"stud"}),s._v(" "),s.editable?i("div",{staticClass:"memo_oper"},[i("div",{staticClass:"rs_bottom"}),s._v(" "),i("div",{staticClass:"rs_right"}),s._v(" "),i("div",{staticClass:"rs_rb"}),s._v(" "),i("div",{staticClass:"rs_close"})]):s._e()])},props:["id","json","scale","locked","editable"],data:()=>({}),computed:{myClass(){return this.locked?"GooFlow_memo lock":"GooFlow_memo"},style(){return{left:this.json.left*this.scale+"px",top:this.json.top*this.scale+"px"}},mySize(){return(!this.json.width||this.json.width<140)&&(this.json.width=140),(!this.json.height||this.json.height<54)&&(this.json.height=54),{width:this.json.width*this.scale+"px",height:this.json.height*this.scale+"px",padding:1!==this.scale?9*this.scale+"px":void 0}},fontSize(){if(1===this.scale)return{};let s=this.json.width*this.scale,t=this.json.height*this.scale,i=12*this.scale,e=navigator.userAgent.toLowerCase().indexOf("webkit")>-1,a={"font-size":i+"px"};if(i<12&&e){a.transform="scale("+i/12+")";let e=(s-s*this.scale)/2,o=(t-t*this.scale)/2;a.margin=-o+"px "+-e+"px"}else a.transform="none",a["min-height"]=34*this.scale+"px",a.margin="0";return a}}};export default{name:"GooFlow",render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"GooFlow",style:t.whStyle,attrs:{id:t.prop.$id}},[t.opts.haveHead?o("keep-alive",[o("head-bar",{ref:"$head",attrs:{global:t.GooFlow,opts:t.opts,title:t.prop.$title,bgId:t.prop.$id,undoStack:t.prop.$undoStack,redoStack:t.prop.$redoStack},on:{btnClick:t._renderHeadBtnClick}},[t._t("headerCustom",null,{slot:"custom"})],2)],1):t._e(),t._v(" "),t.opts.haveTool?o("keep-alive",[o("tool-bar",{ref:"$tool",attrs:{global:t.GooFlow,opts:t.opts,"ext-flag":t.extFlag,bgId:t.prop.$id,nowType:t.prop.$nowType},on:{updateType:t.switchToolBtn}})],1):t._e(),t._v(" "),o("keep-alive",[o("div",{staticClass:"GooFlow_work"},[o("div",{ref:"$workArea",class:"GooFlow_work_inner"+(t.drawingLine?" crosshair":""),attrs:{unselectable:"on",onselectstart:"return false",onselect:"document.selection.empty()",tabindex:"0"},on:{contextmenu:t._renderRightClick}},[t.extFlag.group?o("div",{ref:"$group",staticClass:"GooFlow_work_group",style:{width:"100%",height:"100%","z-index":t.drawingGroup?5:0}},t._l(t.prop.$areas,function(e,i){return t.prop.$areas?o("area-item",{key:i,attrs:{editable:t.prop.$editable,id:i,json:e,scale:t.scale,locked:!t.drawingGroup}}):t._e()})):t._e(),t._v(" "),t.extFlag.multi?o("ghost",{ref:"$multiGhost",attrs:{multi:t.extFlag.multi}}):t._e(),t._v(" "),t.extFlag.memo?o("div",{ref:"$paper",staticClass:"GooFlow_work_paper",style:{width:"100%",height:"100%","z-index":t.drawingPaper?5:1}},t._l(t.prop.$memos,function(e,i){return t.prop.$memos?o("memo-item",{key:i,attrs:{editable:t.prop.$editable,id:i,json:e,scale:t.scale,locked:!t.drawingPaper}}):t._e()})):t._e(),t._v(" "),o("svg",{ref:"$draw",staticStyle:{"z-index":"2",width:"100%",height:"100%"},attrs:{id:"draw_"+t.opts.id}},[o("defs",[o("marker",{attrs:{id:"arrow1",viewBox:"0 0 6 6",refX:"5",refY:"3",markerUnits:"strokeWidth",markerWidth:"6",markerHeight:"6",orient:"auto"}},[o("path",{attrs:{d:"M 0 0 L 6 3 L 0 6 z",fill:t.GooFlow.color.line,"stroke-width":"0"}})]),t._v(" "),o("marker",{attrs:{id:"arrow2",viewBox:"0 0 6 6",refX:"5",refY:"3",markerUnits:"strokeWidth",markerWidth:"6",markerHeight:"6",orient:"auto"}},[o("path",{attrs:{d:"M 0 0 L 6 3 L 0 6 z",fill:t.GooFlow.color.mark,"stroke-width":"0"}})]),t._v(" "),o("marker",{attrs:{id:"arrow3",viewBox:"0 0 6 6",refX:"5",refY:"3",markerUnits:"strokeWidth",markerWidth:"6",markerHeight:"6",orient:"auto"}},[o("path",{attrs:{d:"M 0 0 L 6 3 L 0 6 z",fill:t.GooFlow.color.mark,"stroke-width":"0"}})])]),t._v(" "),t._l(t.prop.$lines,function(e,i){return o("line-item",{key:i,attrs:{editable:t.prop.$editable,id:i,json:e,global:t.GooFlow,coor:t._getLineCoorInfo(e),focused:i==t.prop.$focus,scale:t.scale}})}),t._v(" "),o("tmp-line",{ref:"$tmpLine",attrs:{global:t.GooFlow}})],2),t._v(" "),t.prop.$editable?o("div",{ref:"$extendRight",staticClass:"Gooflow_extend_right",attrs:{title:t.GooFlow.remarks.extendRight}}):t._e(),t._v(" "),t.prop.$editable?o("div",{ref:"$extendBottom",staticClass:"Gooflow_extend_bottom",attrs:{title:t.GooFlow.remarks.extendBottom}}):t._e(),t._v(" "),t.prop.$editable?o("line-move",{ref:"$lineMove",attrs:{M:"M"}}):t._e(),t._v(" "),t.prop.$editable?o("line-move",{ref:"$lineMoveL",attrs:{M:"Ml"}}):t._e(),t._v(" "),t.prop.$editable?o("line-move",{ref:"$lineMoveR",attrs:{M:"Mr"}}):t._e(),t._v(" "),t.prop.$editable?o("line-mp",{ref:"$mpFrom",attrs:{type:"from"}}):t._e(),t.prop.$editable?o("line-mp",{ref:"$mpTo",attrs:{type:"to"}}):t._e(),t._v(" "),t._l(t.prop.$nodes,function(e,i){return o("node-item",{key:i,attrs:{editable:t.prop.$editable,typeMap:t.prop.$nodeTypeMap,id:i,json:e,global:t.GooFlow,customInfo:t.prop.$nodeCustoms[e.type],focused:i==t.prop.$focus,scale:t.scale}})})],2),t._v(" "),t.extFlag.multi&&t.prop.$editable?o("multi-oper",{ref:"$multiOper"}):t._e(),t._v(" "),t.prop.$editable?o("line-oper",{ref:"$lineOper"}):t._e(),t._v(" "),t.extFlag.autoalign&&t.prop.$editable?o("div",{ref:"$alignH",staticClass:"h-align"}):t._e(),t._v(" "),t.extFlag.autoalign&&t.prop.$editable?o("div",{ref:"$alignV",staticClass:"v-align"}):t._e()],1)]),t._v(" "),t.opts.haveTool?o("keep-alive",[o("ghost",{ref:"$ghost"})],1):t._e(),t._v(" "),t.opts.haveTool?o("keep-alive",[o("textarea",{ref:"$textArea",staticStyle:{display:"none"}})]):t._e()],1)},components:{Ghost:Ghost,HeadBar:HeadBar,Calc:Calc,ToolBar:ToolBar,LineMove:LineMove,LineMp:LineMp,LineOper:LineOper,MultiOper:MultiOper,TmpLine:TmpLine,NodeItem:NodeItem,LineItem:LineItem,AreaItem:AreaItem,MemoItem:MemoItem},props:["property","global","plugIns","navSelector"],data(){let t={width:"100%",height:"100%",id:"GooFlow_"+(new Date).getTime(),nodePrefix:"node_",areaPrefix:"area_",initNum:1,haveHead:!1,headLabel:!1,initLabelText:"newFlow_1",headBtns:[],useOperStack:!1,haveTool:!1,dragAddOper:!1,toolTextWidth:0,haveDirect:!0,haveDirDashed:!1,haveSegment:!1,haveSegDashed:!1,toolBtns:[],nodeCustoms:{},multiKey:"shift"};return Object.assign(t,this.property),{opts:t,GooFlow:{color:{main:"#20A0FF",font:"#15428B",node:"#C0CCDA",line:"#1D8CE0",lineFont:"#777",mark:"#ff8800",mix:"#B6F700",mixFont:"#777"},remarks:{headBtns:{},toolBtns:{},extendRight:"",extendBottom:""}},prop:{$id:t.id,$focus:"",$nowType:"cursor",$nodeTypeMap:{},$nodePrefix:t.nodePrefix,$areaPrefix:t.areaPrefix,$editable:t.haveTool,$deletedItem:{},$workExtendStep:200,$dragAddOper:t.dragAddOper,$nodeCustoms:{},$headBtnEvents:{},$undoStack:[],$redoStack:[],$nodes:{},$nodeCount:0,$lines:{},$lineCount:0,$memos:{},$memoCount:0,$areas:{},$areaCount:0,$extra:{},$title:t.initLabelText,$max:t.initNum},onBtnNewClick:null,onBtnOpenClick:null,onBtnSaveClick:null,onFreshClick:null,onPrintClick:null,onItemFocus:null,onItemBlur:null,onItemMark:null,onItemRightClick:null,onItemDbClick:null,extFlag:{},scale:1,t:{top:0,left:0}}},beforeUpdate(){Goo.draw()},computed:{whStyle(){let t={width:this.opts.width,height:this.opts.height,color:this.GooFlow.color.font};return isNaN(parseFloat(t.width))&&"number"!=typeof t.width?t.width="100%":t.width+="px",isNaN(parseFloat(t.height))&&"number"!=typeof t.height?t.height="100%":t.height+="px",t},drawingLine(){return"direct"===this.prop.$nowType||"dirDashed"===this.prop.$nowType||"segment"===this.prop.$nowType||"segDashed"===this.prop.$nowType},drawingGroup(){return"group"===this.prop.$nowType},drawingPaper(){return"memo"===this.prop.$nowType},inMulti(){return this.$refs.$multiGhost&&"block"===this.$refs.$multiGhost.$el.style.display&&("0px"!==this.$refs.$multiGhost.$el.style.width||"0px"!==this.$refs.$multiGhost.$el.style.height)},_getLineCoorInfo:()=>(function(t){let e=this.prop.$nodes[t.from],o=this.prop.$nodes[t.to];if(!e||!o)return{from:"0,0",to:"0,0",d:""};let i=null;if(t.type&&"sl"!==t.type?("lr"===t.type?(t.Ml||(t.Ml=e.top+e.height/2),t.Mr||(t.Mr=o.top+o.height/2)):(t.Ml||(t.Ml=e.left+e.width/2),t.Mr||(t.Mr=o.left+o.width/2)),i=Calc.calcPolyPoints(e,o,t.type,t.Ml,t.M,t.Mr,this.scale)):i=Calc.calcStartEnd(e,o,this.scale),null==i)return{from:"0,0",to:"0,0",d:""};let l="";if(t.type&&"sl"!==t.type){let t=4*this.scale;l="M "+i.start[0]+" "+i.start[1],i.m0[0]===i.start[0]&&i.m0[1]===i.start[1]||(l+=Calc.drawRect(t,i.start,i.m0,i.m1)),i.m1[0]===i.m0[0]&&i.m1[1]===i.m0[1]||(l+=Calc.drawRect(t,i.m0,i.m1,i.m2)),i.m2[0]===i.m3[0]&&i.m2[1]===i.m3[1]||(l+=Calc.drawRect(t,i.m1,i.m2,i.m3)),i.m3[0]===i.end[0]&&i.m3[1]===i.end[1]||(l+=Calc.drawRect(t,i.m2,i.m3,i.end)),l+=" L "+i.end[0]+" "+i.end[1]}else l="M "+i.start[0]+" "+i.start[1]+" L "+i.end[0]+" "+i.end[1];let a=0,r=0;return t.type&&"sl"!==t.type?(a=(i.m2[0]+i.m1[0])/2,r=(i.m2[1]+i.m1[1])/2):(a=(i.end[0]+i.start[0])/2,r=(i.end[1]+i.start[1])/2),{d:l,from:i.start[0]+","+i.start[1],to:i.end[0]+","+i.end[1],textX:a,textY:r}})},created(){if(this.global&&Object.assign(this.GooFlow,this.global),this.setNodeCustoms(this.opts.nodeCustoms),this.opts.toolBtns&&this.opts.toolBtns.length>0)for(let t=0;t<this.opts.toolBtns.length;++t)this.prop.$nodeTypeMap[this.opts.toolBtns[t].split(" ")[0]]=this.opts.toolBtns[t];if(this.prop.$editable&&Object.assign(this,{onItemAdd:null,onItemDel:null,onItemMove:null,onItemRename:null,onItemResize:null,onLineMove:null,onLineSetType:null,onLinePointMove:null,onLineSetStyle:null}),Goo.au=this.opts.auth,this.prop.$editable&&this.opts.useOperStack&&this._initOperStack(),"object"==typeof this.plugIns)for(const t of this.plugIns)t.flag&&t.methods&&(t.prop&&Object.assign(this.prop,t.prop),t.events&&Object.assign(this,t.events),this.extend(t.methods),this.extFlag[t.flag]=!0,t.initFuncName&&this[t.initFuncName]());Goo.render(),this.t.top=this.opts.haveHead?28:3,this.t.left=this.opts.haveTool?34+this.opts.toolTextWidth:3,Goo.draw()},methods:{_renameTxtHide(){this.$refs.$textArea.value="",this.$refs.$textArea.dataset.id=void 0,this.$refs.$textArea.style.display="none"},_renameTxtShow(e){for(let t in e)this.$refs.$textArea.style[t]="number"==typeof e[t]?e[t]+"px":e[t];this.$refs.$textArea.style.display="block"},_renderHeadBtnClick(e){switch(e){case"ico_new":null!==this.onBtnNewClick&&this.onBtnNewClick();break;case"ico_open":null!==this.onBtnOpenClick&&this.onBtnOpenClick();break;case"ico_save":null!==this.onBtnSaveClick&&this.onBtnSaveClick();break;case"ico_undo":this.undo();break;case"ico_redo":this.redo();break;case"ico_reload":null!==this.onFreshClick&&this.onFreshClick();break;case"ico_print":null!==this.onPrintClick&&this.onPrintClick();break;default:let t=e.split("ico_")[1];void 0!==this.prop.$headBtnEvents&&"function"==typeof this.prop.$headBtnEvents[t]&&this.prop.$headBtnEvents[t].call(this)}},_initOperStack(){this.isUndo=0,this.pushOper=function(e,t){1===this.isUndo?(this.prop.$redoStack.push([e,t]),this.isUndo=0,this.prop.$redoStack.length>50&&this.prop.$redoStack.shift()):(this.prop.$undoStack.push([e,t]),this.prop.$undoStack.length>50&&this.prop.$undoStack.shift(),0===this.isUndo&&this.prop.$redoStack.splice(0,this.prop.$redoStack.length),this.isUndo=0)},this.pushExternalOper=function(e,t){this.pushOper("externalFunc",[e,t])},this.undo=function(){if(0===this.prop.$undoStack.length)return;this.blurItem();let e=this.prop.$undoStack.pop();this.isUndo=1,"externalFunc"===e[0]?e[1][0](e[1][1]):this[e[0]].apply(this,e[1])},this.redo=function(){if(0===this.prop.$redoStack.length)return;this.blurItem();let e=this.prop.$redoStack.pop();this.isUndo=2,"externalFunc"===e[0]?e[1][0](e[1][1]):this[e[0]].apply(this,e[1])}},_node2Area(e){if(!this.extFlag.group)return;let t=this.prop.$nodes[e],o=!1;for(let r in this.prop.$areas){let s=this.prop.$areas[r];if(t.left>=s.left&&t.left<s.left+s.width&&t.top>=s.top&&t.top<s.top+s.height){this.prop.$nodes[e].areaId=r,o=!0;break}}o||delete this.prop.$nodes[e].areaId},_setPolyCoor(e,t,o,r,s,i){let l=this.prop.$lines[e];if(!l||t<0||l[o]===t||!l.type||"sl"===l.type)return!1;if(!1!==s&&"function"==typeof this.onLineMove&&!1===this.onLineMove(e,t,o||"M"))return!1;if("function"==typeof this.pushOper&&!r){let t=[e,l[o]];this.pushOper("setLine"+o,t)}l[o]=t,this.prop.$editable&&(l.alt=!0),this.$set(this.prop.$lines[e],l),!i&&this.prop.$navMap&&this.$nextTick(function(){this.refreshMap()})},_resetLines(e){for(let t in this.prop.$lines){let o=this.prop.$lines[t];o.from!==e&&o.to!==e||this.$set(this.prop.$lines,t,o)}},_suitSize(){let e=0,t=0;for(let o in this.prop.$nodes){let r=this.prop.$nodes[o];e<r.width+r.left&&(e=r.width+r.left),t<r.height+r.top&&(t=r.height+r.top)}if(null!=this.$refs.$group)for(let o in this.prop.$areas){let r=this.prop.$areas[o];e<r.width+r.left&&(e=r.width+r.left),t<r.height+r.top&&(t=r.height+r.top)}for(let o in this.prop.$lines){let r=this.prop.$lines[o];""!==r.M&&"lt"===r.type&&e<r.M&&(e=r.M+4),""!==r.M&&"tb"===r.type&&t<r.M&&(t=r.M+4)}if(null!=this.$refs.$paper)for(let o in this.prop.$memos){let r=this.prop.$memos[o];e<r.width+r.left&&(e=r.width+r.left),t<r.height+r.top&&(t=r.height+r.top)}return{width:e*this.scale,height:t*this.scale}},_buildWorkSize(){let e=this.$refs.$workArea.parentNode,t=e.offsetWidth,o=e.offsetHeight,r=this._suitSize();for(;r.width>t;)t+=this.prop.$workExtendStep;for(;r.height>o;)o+=this.prop.$workExtendStep;return{width:t,height:o,haveData:r.width>0&&r.height>0}},_bindMoveEvent(e,t,o,r,s,i){let l=Calc.mouseP(e),n=this.t;r||(r="move");let p=this.$refs.$workArea,a=0,f=0,c=e.id,d=l.x-n.left+p.parentNode.scrollLeft,h=l.y-n.top+p.parentNode.scrollTop,$=this.$refs.$ghost;"move"!==r?($.show({width:t.width*this.scale+"px",height:t.height*this.scale+"px",top:t.top*this.scale+n.top-p.parentNode.scrollTop+"px",left:t.left*this.scale+n.left-p.parentNode.scrollLeft+"px",cursor:r}),a=t.left*this.scale+t.width*this.scale-d,f=t.top*this.scale+t.height*this.scale-h):(a=d-t.left*this.scale,f=h-t.top*this.scale);let u=!1,w=this;document.onmousemove=function(e){e||(e=window.event);let o=Calc.mouseP(e);if("move"!==r)switch(d=o.x-n.left+p.parentNode.scrollLeft-t.left*w.scale+a,h=o.y-n.top+p.parentNode.scrollTop-t.top*w.scale+f,d<s*w.scale&&(d=s*w.scale),h<i*w.scale&&(h=i*w.scale),r){case"nw-resize":$.show({width:d+"px",height:h+"px"});break;case"w-resize":$.show({width:d+"px"});break;case"n-resize":$.show({height:h+"px"})}else{if(d===o.x-a&&h===o.y-f)return Calc.stopEventPop(e),!1;d=o.x-a,h=o.y-f,$.inShow()||$.css({width:t.width*w.scale+"px",height:t.height*w.scale+"px",top:t.top*w.scale+n.top-p.parentNode.scrollTop+"px",left:t.left*w.scale+n.left-p.parentNode.scrollLeft+"px",cursor:"move"}),u&&$.show(),d<n.left-p.parentNode.scrollLeft&&!t.canOver?d=n.left-p.parentNode.scrollLeft:d+p.parentNode.scrollLeft+t.width*w.scale>n.left+p.offsetWidth&&!t.canOver&&(d=n.left+p.offsetWidth-p.parentNode.scrollLeft-t.width*w.scale),h<n.top-p.parentNode.scrollTop&&!t.canOver?h=n.top-p.parentNode.scrollTop:h+p.parentNode.scrollTop+t.height*w.scale>n.top+p.offsetHeight&&!t.canOver&&(h=n.top+p.offsetHeight-p.parentNode.scrollTop-t.height*w.scale),u?$.show({left:d+"px",top:h+"px"}):$.css({left:d+"px",top:h+"px"}),w.extFlag.autoalign;{let e=w._locAlignLine(c,$,w.prop.$nowType);w._magnetic($,e),w.$nextTick(function(){d=parseInt($.$el.style.left.split("px")[0],10),h=parseInt($.$el.style.top.split("px")[0],10)})}}u=!0},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null;let e=(d+p.parentNode.scrollLeft-n.left)/w.scale,t=(h+p.parentNode.scrollTop-n.top)/w.scale,s=$.offsetSize();$.hide();let i=s.width/w.scale,l=s.height/w.scale;w.extFlag.autoalign,w.$refs.$alignH.style.display="none",w.$refs.$alignV.style.display="none",o&&"function"==typeof o&&o(u,w,r,e,t,i,l)}},_initDraw(){const e=this;EventAgent(this.$refs.$draw,"click","g",{},function(t,o){e.prop.$multiKey&&e._isMultiKey(t)?(e.prop.$focus===o.id&&e.blurItem(),e.prop.$editable&&e.prop.$multiLines&&(e.prop.$multiLines[o.id]?e._removeFromMultiList(o.id,"line",!0):e._addtoMultiList(o.id,"line",!0))):e.prop.$focus!==o.id?e.focusItem(o.id,!0):e.$refs.$lineOper.setTid(o.id)}),this.prop.$editable&&(EventAgent(this.$refs.$draw,"contextmenu","g",{},function(t,o){if("function"==typeof e.onItemRightClick&&!1===e.onItemRightClick(o.id,"line"))return Calc.preventDefault(t),!1}),EventAgent(this.$refs.$draw,"dblclick","g",{},function(t,o){if("function"==typeof e.onItemDbClick&&!1===e.onItemDbClick(o.id,"line"))return;let r=o.querySelector("text").textContent,s=o.getAttribute("from").split(","),i=o.getAttribute("to").split(",");"lr"===e.prop.$lines[o.id].type?(s[0]=e.prop.$lines[o.id].M*e.scale,i[0]=s[0]):"tb"===e.prop.$lines[o.id].type&&(s[1]=e.prop.$lines[o.id].M*e.scale,i[1]=s[1]);let l=(parseInt(s[0],10)+parseInt(i[0],10))/2-64,n=(parseInt(s[1],10)+parseInt(i[1],10))/2-18,p=e.t;e.$refs.$textArea.value=r,e._renameTxtShow({width:130,height:26,left:p.left+l-e.$refs.$workArea.parentNode.scrollLeft,top:p.top+n-e.$refs.$workArea.parentNode.scrollTop}),e.$refs.$textArea.dataset.id=e.prop.$focus,e.$refs.$textArea.focus(),e.$refs.$workArea.parentNode.onmousedown=function(t){e.$refs.$workArea.parentNode.onmousedown=null,2!==t.button?(e.setName(e.$refs.$textArea.dataset.id,e.$refs.$textArea.value,"line"),e._renameTxtHide()):Calc.stopEventPop(t)}}))},_initWorkForNode(){let e=this;EventAgent(this.$refs.$workArea,"click",".GooFlow_item",{},function(t,o){e.prop.$focus===o.id||e.prop.$multiKey&&e._isMultiKey(t)?Class.hasClass(t.target,"rs_close")&&e.prop.$editable?e.delNode(o.id):e.prop.$multiKey&&e._isMultiKey(t)&&(e.prop.$focus===o.id&&e.blurItem(),e.prop.$editable&&e.prop.$multiNodes&&(e.prop.$multiNodes[o.id]?e._removeFromMultiList(o.id,"node",!0):e._addtoMultiList(o.id,"node",!0))):e.focusItem(o.id,!0),Calc.stopEventPop(t)}),EventAgent(this.$refs.$workArea,"contextmenu",".GooFlow_item",{},function(t,o){if("function"==typeof e.onItemRightClick&&!1===e.onItemRightClick(o.id,"node"))return Calc.stopEventPop(t),!1});const t=function(e){e.$refs.$workArea.parentNode.onmousedown=function(t){if(e.$refs.$workArea.parentNode.onmousedown=null,2===t.button)return void Calc.stopEventPop(t);let o=e.$refs.$textArea;e.setName(o.dataset.id,o.value,"node"),e._renameTxtHide()}};EventAgent(this.$refs.$workArea,"dblclick",".GooFlow_item",{},function(o,r){let s=r.id;if("function"==typeof e.onItemDbClick&&!1===e.onItemDbClick(s,"node"))return!1;if(!e.prop.$editable)return;const i=o.target,l=e.t;let n=e.$refs.$textArea,p="";if("DIV"===i.tagName.toUpperCase()&&Class.hasClass(i,"span"))p=i.innerHTML,n.value=p,e._renameTxtShow({height:r.offsetHeight+6,width:100,left:l.left+e.prop.$nodes[s].left*e.scale-e.$refs.$workArea.parentNode.scrollLeft-26,top:l.top+e.prop.$nodes[s].top*e.scale-e.$refs.$workArea.parentNode.scrollTop+26}),n.dataset.id=e.prop.$focus,n.focus(),t(e);else if("DIV"===i.tagName.toUpperCase()&&"TD"===i.parentNode.tagName.toUpperCase()&&Class.hasClass(i.parentNode.previousSibling,"ico")||"TD"===i.tagName.toUpperCase()&&Class.hasClass(i.previousSibling,"ico")){let o=r.querySelector(".ico + td");p=o.childNodes[0].innerHTML,n.value=p,e._renameTxtShow({width:o.offsetWidth+26,height:o.offsetHeight+6,left:l.left+26+e.prop.$nodes[s].left*e.scale-e.$refs.$workArea.parentNode.scrollLeft,top:l.top+2+e.prop.$nodes[s].top*e.scale-e.$refs.$workArea.parentNode.scrollTop}),n.dataset.id=e.prop.$focus,n.focus(),t(e)}}),this.prop.$editable&&(EventAgent(this.$refs.$workArea,"mousedown",".GooFlow_item",{},function(t,o){if(2===t.button)return!1;let r=t.target;if(Calc.isDrawingLine(e)){let r,s,i=Calc.mouseP(t),l=Calc.elCsys(e.$refs.$workArea);r=i.x-l.left+e.$refs.$workArea.parentNode.scrollLeft,s=i.y-l.top+e.$refs.$workArea.parentNode.scrollTop,e.lineStart={x:r,y:s,id:o.id},e.$refs.$tmpLine.setState({d:"M "+r+" "+s+" L "+r+" "+s,display:"block",dash:"dirDashed"===e.prop.$nowType||"segDashed"===e.prop.$nowType,noArrow:"segment"===e.prop.$nowType||"segDashed"===e.prop.$nowType}),Calc.stopEventPop(t)}else if("TD"===r.tagName||"TD"===r.parentNode.tagName){if(Calc.isDrawingLine(e))return;if("cursor"===e.prop.$nowType&&e.$refs.$multiGhost&&e.$refs.$multiGhost.inShow())return;let r=o.childNodes[0].cloneNode(!0);e.$refs.$ghost.append(r),t.id=o.id,e._bindMoveEvent(t,e.prop.$nodes[o.id],function(e,t,r,s,i){e&&t.moveNode(o.id,s,i),o.id!==t.prop.$focus&&t.focusItem(o.id,!0)})}else if("DIV"===r.tagName.toUpperCase()&&(Class.hasClass(r,"rs_bottom")||Class.hasClass(r,"rs_right")||Class.hasClass(r,"rs_rb"))){let o=Class.hasClass(r,"rs_bottom")?"n-resize":Class.hasClass(r,"rs_right")?"w-resize":"nw-resize";if("pointer"===o)return;let s=e.prop.$focus;e.switchToolBtn("cursor"),Calc.stopEventPop(t),e.$refs.$ghost.$el.style.cursor=o;let i=e.prop.$nodes[s];e._bindMoveEvent(t,i,function(e,t,o,r,i,l,n){e&&t.resizeNode(s,l,n)},o,104,26)}}),EventAgent(this.$refs.$workArea,"mouseup",".GooFlow_item",{},function(t,o){if(!Calc.isDrawingLine(e)&&!e.$refs.$mpTo.getP())return;let r=e.lineStart,s=e.lineEnd;if(r&&!e.$refs.$mpTo.getP()){let t={from:r.id,to:o.id,name:"",M:"",type:"sl"};"dirDashed"!==e.prop.$nowType&&"segDashed"!==e.prop.$nowType||(t.dash=!0),"segment"!==e.prop.$nowType&&"segDashed"!==e.prop.$nowType||(t.noArrow=!0),e.addLine((new Date).getTime(),t),e.prop.$max++}else r?e.moveLinePoints(e.prop.$focus,r.id,o.id):s&&e.moveLinePoints(e.prop.$focus,o.id,s.id)}))},_initEditFunc(){let e=this;this.$refs.$workArea.addEventListener("mousemove",function(t){if(!Calc.isDrawingLine(e)&&!e.$refs.$mpTo.getP())return;if(!e.lineStart&&!e.lineEnd)return;let o=Calc.mouseP(t),r=Calc.elCsys(this),s=o.x-r.left+this.parentNode.scrollLeft,i=o.y-r.top+this.parentNode.scrollTop,l=e.$refs.$tmpLine.getState();e.lineStart?l.d="M "+e.lineStart.x+" "+e.lineStart.y+" L "+s+" "+i:e.lineEnd&&(l.d="M "+s+" "+i+" L "+e.lineEnd.x+" "+e.lineEnd.y),l.noArrow="segment"===e.prop.$nowType||"segDashed"===e.prop.$nowType,l.dash="dirDashed"===e.prop.$nowType||"segDashed"===e.prop.$nowType,e.$refs.$tmpLine.setState(l)}),this.$refs.$workArea.addEventListener("mouseup",function(t){if(!Calc.isDrawingLine(e)&&!e.$refs.$mpTo.getP())return;const o=e.$refs.$tmpLine.getState();"none"!==o.display?(delete e.lineStart,delete e.lineEnd,o.display="none",e.$refs.$tmpLine.setState(o),e.$refs.$mpTo.hide(),e.$refs.$mpFrom.hide(),e.focusItem(e.prop.$focus,!1)):e.$refs.$lineOper.setTid(0)}),this.$refs.$workArea.addEventListener("keydown",function(t){if(!e.$refs.$ghost.inShow()&&"none"===e.$refs.$textArea.style.display)switch(t.keyCode){case 46:if(""!==e.prop.$focus)e.delNode(e.prop.$focus,!0),e.delLine(e.prop.$focus);else if("cursor"===e.prop.$nowType&&e.$refs.$multiGhost&&e.$refs.$multiGhost.inShow()){let t=[],o=[];for(let o in e.prop.$multiNodes)t.push(o);for(let t in e.prop.$multiLines)o.push(t);e.batchDelete(t,o),e._wallAllMulti()}break;case 67:if(t.ctrlKey){if(!e.prop.$nodes[e.prop.$focus])return;e.copyNode(e.prop.$focus)}break;case 86:if(t.ctrlKey){if(!e.prop.$clipNode||null==e.prop.$clipNode)return;e.parseNode()}}})},_initExpendFunc:function(){let e=this,t=this.prop.$workExtendStep,o=this.$refs.$workArea,r=this.$refs.$workArea.parentNode;this.$refs.$extendRight.addEventListener("click",function(s){o.style.width=o.offsetWidth+t+"px",e.$refs.$alignV&&(e.$refs.$alignV.style.width=o.style.width),r.scrollLeft=r.scrollWidth,r.style.overflow="scroll",Calc.stopEventPop(s)}),this.$refs.$extendBottom.addEventListener("click",function(s){o.style.height=o.offsetHeight+t+"px",e.$refs.$alignH&&(e.$refs.$alignH.style.height=o.style.height),r.scrollTop=r.scrollHeight,r.style.overflow="scroll",Calc.stopEventPop(s)})},_renderClick(e){e||(e=window.event);let t=this.prop.$nowType;if("cursor"===t){let t=e.target,o=t.tagName.toUpperCase();if("SVG"===o||"DIV"===o&&t.className.indexOf("GooFlow_work")>-1||"LABEL"===o)if(this.$refs.$lineOper&&this.$refs.$lineOper.getTid())this.focusItem(this.$refs.$lineOper.getTid(),!1);else if(this.extFlag.multi){const e=Object.keys(this.prop.$multiNodes),t=Object.keys(this.prop.$multiLines);0===e.length&&1===t.length?(delete this.prop.$multiLines[t],this.focusItem(t[0],!0)):1===e.length&&0===t.length?(delete this.prop.$multiNodes[e],this.focusItem(e[0],!0)):0===e.length&&0===t.length&&this.blurItem()}else this.inMulti&&this.prop.$editable||this.blurItem();return}if("direct"===t||"segment"===t||"dirDashed"===t||"segDashed"===t||"group"===t||"memo"===t)return;if(!this.prop.$editable||this.prop.$dragAddOper)return;let o=Calc.getCoor(e,this.$refs.$workArea);this.addNode((new Date).getTime(),{name:this.prop.$nodePrefix+this.prop.$max,left:o.X/this.scale,top:o.Y/this.scale,type:this.prop.$nowType}),this.prop.$max++},_renderRightClick(e){"SVG"===e.target.tagName.toUpperCase()&&(this.blurItem(),Calc.preventDefault(e))},_bindScrollScaleEvent(){let e=this,t=function(t){let o=0;if((t=t||window.event).wheelDelta&&t.ctrlKey)o=-1*t.wheelDelta;else{if(!t.detail||!t.ctrlKey)return;o=t.detail}window.event?window.event.returnValue=!1:t.preventDefault();let r=o>0?-.1:o<0?.1:0;e.resetScale(e.scale+r)};document.addEventListener&&this.$el.addEventListener("DOMMouseScroll",t,!1),this.$el.onmousewheel=t},bindHeadBtnEvent(t){this.opts.haveHead&&Object.assign(this.prop.$headBtnEvents,t)},bindOperEvent(t){if("object"==typeof t)for(let e in t)"function"==typeof t[e]&&(this[e]=t[e])},switchToolBtn(t){this.prop.$nowType!==t&&(this.prop.$dragAddOper&&"cursor"!==t&&!Calc.isDrawingLine(t)&&"group"!==t&&"memo"!==t||(this.prop.$nowType=t,this.$set(this.prop,"$nowType",t),"cursor"!==t&&this.blurItem()))},setDragAddOper:function(t){this.prop.$dragAddOper=t||!1},setNodeCustoms(t){Object.assign(this.prop.$nodeCustoms,t)},setTitle(t){this.$set(this.prop,"$title",t)},addNode(t,e,s,i,r,p){!1!==s&&"function"==typeof this.onItemAdd&&!1===this.onItemAdd(t,"node",e)||("function"==typeof this.pushOper&&this.prop.$editable&&!i&&this.pushOper("delNode",[t]),p?this.prop.$nodes[t]=e:this.$set(this.prop.$nodes,t,e),++this.prop.$nodeCount,this.prop.$editable&&(this.prop.$nodes[t].alt=!0,this.prop.$deletedItem[t]&&delete this.prop.$deletedItem[t]),!r&&this.prop.$navMap&&this.$nextTick(function(){this.refreshMap()}))},moveNode(t,e,s,i,r,p){if(!this.prop.$nodes[t])return;if(!1!==i&&"function"==typeof this.onItemMove&&!1===this.onItemMove(t,"node",e,s))return;if("function"==typeof this.pushOper&&this.prop.$editable&&!r){let e=[t,this.prop.$nodes[t].left,this.prop.$nodes[t].top];this.pushOper("moveNode",e)}e<0&&(e=0),s<0&&(s=0),this.prop.$nodes[t].left=e,this.prop.$nodes[t].top=s,this._resetLines(t);let o=document.getElementById(t);o.style.left=e*this.scale+"px",o.style.top=s*this.scale+"px",this.prop.$editable&&(this.prop.$nodes[t].alt=!0,this._node2Area(t)),!p&&this.prop.$navMap&&this.$nextTick(function(){this.refreshMap()})},resizeNode(t,e,s){if(!this.prop.$nodes[t])return;if("function"==typeof this.onItemResize&&!1===this.onItemResize(t,"node",e,s))return;let i=this.prop.$nodes[t].type,r=this.prop.$nodeTypeMap[i]||i;if(r.indexOf(" round")>0||r.indexOf(" rhomb")>0||this.prop.$nodeCustoms[i])return;if("function"==typeof this.pushOper){let e=[t,this.prop.$nodes[t].width,this.prop.$nodes[t].height];this.pushOper("resizeNode",e)}let p=this.prop.$nodes[t],o=document.getElementById(t);o.childNodes[0].style.width=e*this.scale-2+"px",o.childNodes[0].style.height=s*this.scale-2+"px",p.width=o.offsetWidth/this.scale,p.height=o.offsetHeight/this.scale,o.childNodes[0].style.height=p.height*this.scale-2+"px",this.$editable&&(p.alt=!0),this.$set(this.prop.$nodes[t],p),this._resetLines(t),this._node2Area(t),this.prop.$navMap&&this.$nextTick(function(){this.refreshMap()})},copyNode:function(t){this.prop.$clipNode=this.getItemInfo(t,"node")},parseNode:function(){this.prop.$clipNode&&null!=this.prop.$clipNode&&(this.prop.$clipNode.top+=30,this.prop.$clipNode.left+=30,this.addNode((new Date).getTime(),JSON.parse(JSON.stringify(this.prop.$clipNode))))},delNode(t,e,s,i){if(this.prop.$nodes[t]&&(!1===e||"function"!=typeof this.onItemDel||!1!==this.onItemDel(t,"node"))){for(let e in this.prop.$lines)this.prop.$lines[e].from!==t&&this.prop.$lines[e].to!==t||this.delLine(e,!1);if("function"==typeof this.pushOper&&!s){let e=[t,this.prop.$nodes[t]];this.pushOper("addNode",e)}this.$delete(this.prop.$nodes,t),--this.prop.$nodeCount,this.prop.$focus===t&&(this.prop.$focus=""),this.prop.$editable&&(this.prop.$deletedItem[t]="node"),!i&&this.prop.$navMap&&this.$nextTick(function(){this.refreshMap()})}},addLine(t,e,s,i,r,p){if(e.from===e.to)return;let o=this.prop.$nodes[e.from],h=this.prop.$nodes[e.to];o&&h&&(!1!==s&&"function"==typeof this.onItemAdd&&!1===this.onItemAdd(t,"line",e)||("function"==typeof this.pushOper&&this.prop.$editable&&!i&&this.pushOper("delLine",[t]),e.M||(e.M=""),(!e.type||"lr"!==e.type&&"tb"!==e.type)&&(e.type="sl"),e.marked||(e.marked=!1),p?this.prop.$lines[t]=e:this.$set(this.prop.$lines,t,e),++this.prop.$lineCount,this.prop.$editable&&(this.prop.$lines[t].alt=!0,this.prop.$deletedItem[t]&&delete this.prop.$deletedItem[t]),!r&&this.prop.$navMap&&this.$nextTick(function(){this.refreshMap()})))},setLineM(t,e,s,i,r){this._setPolyCoor(t,e,"M",s,i,r)},setLineMl(t,e,s,i,r){this._setPolyCoor(t,e,"Ml",s,i,r)},setLineMr(t,e,s,i,r){this._setPolyCoor(t,e,"Mr",s,i,r)},setLineStyle(t,e){let s="direct",i=this.prop.$lines[t];if(!i)return!1;if(i.dash&&(s="dirDashed"),i.noArrow&&(s=i.dash?"segDashed":"segment"),!e||e===s||"direct"!==e&&"dirDashed"!==e&&"segment"!==e&&"segDashed"!==e)return!1;if("function"==typeof this.onLineSetStyle&&!1===this.onLineSetStyle(t,e))return;switch(e){case"direct":i.dash=!1,i.noArrow=!1;break;case"dirDashed":i.dash=!0,i.noArrow=!1;break;case"segment":i.dash=!1,i.noArrow=!0;break;case"segDashed":i.dash=!0,i.noArrow=!0;break;default:return}const r=document.getElementById(t).querySelectorAll("path")[1];if(i.dash?r.setAttribute("style","stroke-dasharray:5,6"):r.removeAttribute("style"),i.noArrow?r.removeAttribute("marker-end"):i.marked?r.setAttribute("marker-end","url(#arrow2)"):r.setAttribute("marker-end","url(#arrow1)"),this.$undoStack){let e=[t,s];this.pushOper("setLineStyle",e)}if(this.prop.$editable&&(i.alt=!0),this.prop.$focus===t){let e=this;this.$nextTick(function(){e.focusItem(t)})}this.prop.$navMap&&this.$nextTick(function(){this.refreshMap()})},setLineType(t,e,s){let i=this.prop.$lines[t];if(!e||null==e||""===e||!i||e===i.type)return!1;if("function"==typeof this.onLineSetType&&!1===this.onLineSetType(t,e))return;if("function"==typeof this.pushOper){let e=[t,i.type||"sl",i.M];this.pushOper("setLineType",e)}let r=i.from,p=i.to,o=this.prop.$nodes[r],h=this.prop.$nodes[p];if(i.type=e,this.prop.$editable&&(i.alt=!0),"sl"!==e?(s||(s=Calc.getMValue(o,h,e)),"lr"===e?(i.Ml=o.top+o.height/2,i.Mr=h.top+h.height/2):(i.Ml=o.left+o.width/2,i.Mr=h.left+h.width/2),this.setLineM(t,s,!0,!1)):(i.M="",i.Ml="",i.Mr="",this.$set(this.prop.$lines[t],i),this.$refs.$lineMove.hide(),this.$refs.$lineMoveL.hide(),this.$refs.$lineMoveR.hide()),this.prop.$focus===t){let e=this;this.$nextTick(function(){e.focusItem(t)})}this.prop.$navMap&&this.$nextTick(function(){this.refreshMap()})},moveLinePoints(t,e,s,i){if(e===s)return;if(!t||!this.prop.$lines[t])return;null!=e&&""!==e||(e=this.prop.$lines[t].from),null!=s&&""!==s||(s=this.prop.$lines[t].to);for(let t in this.prop.$lines)if(e===this.prop.$lines[t].from&&s===this.prop.$lines[t].to)return;if("function"==typeof this.onLinePointMove&&!1===this.onLinePointMove(t,e,s))return;if("function"==typeof this.pushOper&&!i){let e=[t,this.prop.$lines[t].from,this.prop.$lines[t].to];this.pushOper("moveLinePoints",e)}let r=this.prop.$lines[t];null!=e&&""!==e&&(r.from=e),null!=s&&""!==s&&(r.to=s),this.prop.$editable&&(r.alt=!0),this.$set(this.prop.$lines[t],r),this.prop.$navMap&&this.$nextTick(function(){this.refreshMap()})},delLine:function(t,e,s,i){if(this.prop.$lines[t]&&(!1===e||"function"!=typeof this.onItemDel||!1!==this.onItemDel(t,"line"))){if("function"==typeof this.pushOper&&!s){let e=[t,this.prop.$lines[t]];this.pushOper("addLine",e)}this.$delete(this.prop.$lines,t),--this.prop.$lineCount,this.prop.$editable&&(this.prop.$deletedItem[t]="line",this.prop.$focus===t&&(this.$refs.$mpFrom.hide(),this.$refs.$mpTo.hide(),this.$refs.$lineMove.hide(),this.$refs.$lineMoveL.hide(),this.$refs.$lineMoveR.hide(),this.$refs.$lineOper&&this.$refs.$lineOper.hide())),this.prop.$focus===t&&(this.prop.$focus=""),!i&&this.prop.$navMap&&this.$nextTick(function(){this.refreshMap()})}},blurItem(t){if(""!==this.prop.$focus){let e=this.prop.$focus;if("DIV"===document.getElementById(e).tagName.toUpperCase()){if(delete this.prop.$clipNode,!t&&"function"==typeof this.onItemBlur&&!1===this.onItemBlur(this.prop.$focus,"node"))return!1}else{if(!t&&"function"==typeof this.onItemBlur&&!1===this.onItemBlur(this.prop.$focus,"line"))return!1;this.prop.$editable&&(this.$refs.$lineMove.hide(),this.$refs.$lineMoveL.hide(),this.$refs.$lineMoveR.hide(),this.$refs.$lineOper.hide(),this.$refs.$mpFrom.hide(),this.$refs.$mpTo.hide())}}else this.prop.$editable&&this.prop.$multiNodes&&this._clearMultiList();return this.prop.$focus="",!0},focusItem(t,e){if(!t||null==t||""===t)return;let s=document.getElementById(t);if(null!=s&&this.blurItem(!e)){if("DIV"===s.tagName.toUpperCase()){if(e&&"function"==typeof this.onItemFocus&&!1===this.onItemFocus(t,"node"))return;this.prop.$focus=t}else{if(e&&"function"==typeof this.onItemFocus&&!1===this.onItemFocus(t,"line"))return;if(this.prop.$focus=t,!this.prop.$editable)return;let i=this.prop.$lines[t],r=s.getAttribute("from").split(","),p=s.getAttribute("to").split(",");r[0]=parseInt(r[0],10),r[1]=parseInt(r[1],10),p[0]=parseInt(p[0],10),p[1]=parseInt(p[1],10);let o=[r[0],r[1],p[0],p[1]];"lr"===i.type?(this.$refs.$lineMove.show({width:"5px",height:Math.abs(i.Ml-i.Mr)*this.scale+"px",left:i.M*this.scale-3+"px",top:(i.Mr>i.Ml?i.Ml:i.Mr)*this.scale+1+"px",cursor:"e-resize",display:"block"}),this.$refs.$lineMove.setData({type:"lr",tid:t}),this.$refs.$lineMoveL.show({height:"5px",width:Math.abs(r[0]-i.M)*this.scale+"px",top:i.Ml*this.scale-3+"px",left:(i.M>r[0]?r[0]:i.M)*this.scale+1+"px",cursor:"s-resize",display:"block"}),this.$refs.$lineMoveL.setData({type:"lr",tid:t}),this.$refs.$lineMoveR.show({height:"5px",width:Math.abs(p[0]-i.M)*this.scale+"px",top:i.Mr*this.scale-3+"px",left:(i.M>p[0]?p[0]:i.M)*this.scale+1+"px",cursor:"s-resize",display:"block"}),this.$refs.$lineMoveR.setData({type:"lr",tid:t}),r[0]=i.M*this.scale,p[0]=r[0]):"tb"===i.type?(this.$refs.$lineMove.show({width:Math.abs(i.Ml-i.Mr)*this.scale+"px",height:"5px",left:(i.Mr>i.Ml?i.Ml:i.Mr)+1+"px",top:i.M*this.scale-3+"px",cursor:"s-resize",display:"block"}),this.$refs.$lineMove.setData({type:"tb",tid:t}),this.$refs.$lineMoveL.show({height:Math.abs(r[1]-i.M)*this.scale+"px",width:"5px",top:(i.M>r[1]?r[1]:i.M)+1+"px",left:i.Ml*this.scale-3+"px",cursor:"e-resize",display:"block"}),this.$refs.$lineMoveL.setData({type:"tb",tid:t}),this.$refs.$lineMoveR.show({height:Math.abs(p[1]-i.M)*this.scale+"px",width:"5px",top:(i.M>p[1]?p[1]:i.M)+1+"px",left:i.Mr*this.scale-3+"px",cursor:"e-resize",display:"block"}),this.$refs.$lineMoveR.setData({type:"tb",tid:t}),r[1]=i.M*this.scale,p[1]=r[1]):(this.$refs.$lineMove.hide(),this.$refs.$lineMove.setData({}),this.$refs.$lineMoveL.hide(),this.$refs.$lineMoveL.setData({}),this.$refs.$lineMoveR.hide(),this.$refs.$lineMoveR.setData({}));let h=(r[0]+p[0])/2-40,l=(r[1]+p[1])/2+4,n=this.$refs.$lineOper;n.show({display:"block",left:h+"px",top:l+"px"}),n.setTid(t),(n=this.$refs.$mpFrom).show({left:o[0]-4+"px",top:o[1]-4+"px"}),n.setP(o[0]+","+o[1]),(n=this.$refs.$mpTo).show({left:o[2]-4+"px",top:o[3]-4+"px"}),n.setP(o[2]+","+o[3])}this.switchToolBtn("cursor")}},setItemExtra(t,e,s){if(null==t||""===t)return;if(null==e||""===e)return;let i="node"===e?this.prop.$nodes[t]:"line"===e?this.prop.$lines[t]:"area"===e?this.prop.$areas[t]:this.prop.$memos[t];for(let t in s)i[t]=s[t]},delItemExtra(t,e,s){if(null==t||""===t)return;if(null==e||""===e)return;let i="node"===e?this.prop.$nodes[t]:"line"===e?this.prop.$lines[t]:"area"===e?this.prop.$areas[t]:this.prop.$memos[t];for(let t=0;t<s.length;++t)delete i[s[t]]},getItemInfo(t,e){switch(e){case"node":return JSON.parse(JSON.stringify(this.prop.$nodes[t]||null));case"line":return JSON.parse(JSON.stringify(this.prop.$lines[t]||null));case"area":return JSON.parse(JSON.stringify(this.prop.$areas[t]||null));case"memo":return JSON.parse(JSON.stringify(this.prop.$memos[t]||null));default:return JSON.parse(JSON.stringify(this.prop.$nodes[t]||this.prop.$lines[t]||this.prop.$areas[t]||this.prop.$memos[t]||null))}},markItem(t,e,s,i,r,p){if("node"===e){if(!this.prop.$nodes[t])return;if(!1!==i&&"function"==typeof this.onItemMark&&!1===this.onItemMark(t,"node",s))return;this.$set(this.prop.$nodes[t],"marked",s||!1)}else{if("line"!==e)return;if(!this.prop.$lines[t])return;if(!1!==i&&"function"==typeof this.onItemMark&&!1===this.onItemMark(t,"line",s))return;this.$set(this.prop.$lines[t],"marked",s||!1)}if("function"==typeof this.pushOper&&!r){let i=[t,e,!s];this.pushOper("markItem",i)}!p&&this.prop.$navMap&&this.$nextTick(function(){this.refreshMap()})},setItemColor(t,e,s,i,r){if(null==t||""===t)return;if(null==e||""===e)return;let p="";if("node"===e)p=document.getElementById(t).style.backgroundColor,this.$set(this.prop.$nodes[t],"color",s);else{if("line"!==e)return;p=this.prop.$lines[t].color,this.$set(this.prop.$lines[t],"color",s)}"function"!=typeof this.pushOper||i||this.pushOper("setItemColor",[t,e,p]),!r&&this.prop.$navMap&&this.$nextTick(function(){this.refreshMap()})},setItemFontColor(t,e,s,i){if(null==t||""===t)return;if(null==e||""===e)return;let r="";if("node"===e){let e=this.prop.$nodes[t],i=this.prop.$nodeTypeMap[e.type]||e.type;r=e.fontColor||(i.indexOf(" mix")>-1?this.GooFlow.color.mixFont:this.GooFlow.color.font),this.$set(this.prop.$nodes[t],"fontColor",s)}else{if("line"!==e)return;r=this.prop.$lines[t].fontColor||this.GooFlow.color.lineFont,this.$set(this.prop.$lines[t],"fontColor",s)}"function"!=typeof this.pushOper||i||this.pushOper("setItemFontColor",[t,e,r])},setName(t,e,s,i){let r="";if("node"===s){if(!this.prop.$nodes[t])return;if(this.prop.$nodes[t].name===e)return;if("function"==typeof this.onItemRename&&!1===this.onItemRename(t,e,"node"))return;let s=this.prop.$nodes[t];r=s.name;let p=!1,o=document.getElementById(t),h=this.prop.$nodeTypeMap[s.type]||s.type;if(h.indexOf(" round")<0&&h.indexOf(" rhomb")<0&&!this.prop.$nodeCustoms[s.type]){o.querySelector("td div").innerText=e;let i=o.offsetWidth/this.scale,r=o.offsetHeight/this.scale;s.width===i&&s.height===r||(this.resizeNode(t,i,r),p=!0)}else o.querySelector(".span").innerText=e;s.name=e,this.prop.$editable&&(s.alt=!0),p&&this._resetLines(t),!i&&this.prop.$navMap&&this.$nextTick(function(){this.refreshMap()})}else if("line"===s){if(!this.prop.$lines[t])return;if(this.prop.$lines[t].name===e)return;if("function"==typeof this.onItemRename&&!1===this.onItemRename(t,e,"line"))return;let s=this.prop.$lines[t];r=s.name,s.name=e,this.prop.$editable&&(s.alt=!0),this.$set(this.prop.$lines,t,s)}else{if("area"!==s)return;{if(!this.prop.$areas[t])return;if(this.prop.$areas[t].name===e)return;if("function"==typeof this.onItemRename&&!1===this.onItemRename(t,e,"area"))return;let s=this.prop.$areas[t];r=s.name,s.name=e,this.$editable&&(s.alt=!0),document.getElementById(t).querySelector("label").innerHTML=e}}"function"==typeof this.pushOper&&this.pushOper("setName",[t,r,s])},setExtra(t){if("object"==typeof t)for(let e in t)this.prop.$extra[e]=t[e]},getExtra(){return this.prop.$extra},loadData(t){this.clearData(!0),t.title&&null!=t.title&&""!==t.title.trim()||(t.title=this.prop.$title),this.prop.$deletedItem={},this.prop.$extra=t.extra&&null!=t.extra?t.extra:{},this.prop.$max=void 0===t.initNum?1:t.initNum;for(let e in t.nodes)this.addNode(e,t.nodes[e],!1,!0,!0,!0);for(let e in t.lines)this.addLine(e,t.lines[e],!1,!0,!0,!0);if(this.extFlag.group&&t.areas)for(let e in t.areas)this.addArea(e,t.areas[e],!1,!0,!0,!0);if(this.extFlag.memo&&t.memos)for(let e in t.memos)this.addMemo(e,t.memos[e],!1,!0,!0,!0);let e=this._buildWorkSize();this.$refs.$workArea.style.width=e.width+"px",this.$refs.$workArea.style.height=e.height+"px",this.$refs.$alignV&&(this.$refs.$alignV.style.width=e.width+"px"),this.$refs.$alignH&&(this.$refs.$alignH.style.height=e.height+"px"),this.prop.$title="",this.setTitle(t.title),this.prop.$navMap&&this.$nextTick(function(){this.refreshMap()})},exportData(){let t={title:this.prop.$title,nodes:{},lines:{}};t.initNum=this.prop.$max;for(let e in this.prop.$nodes)t.nodes[e]=JSON.parse(JSON.stringify(this.prop.$nodes[e])),t.nodes[e].marked||delete t.nodes[e].marked;for(let e in this.prop.$lines)t.lines[e]=JSON.parse(JSON.stringify(this.prop.$lines[e])),t.lines[e].marked||delete t.lines[e].marked,""===t.lines[e].M&&delete t.lines[e].M;if(this.extFlag.group){t.areas={};for(let e in this.prop.$areas)t.areas[e]=JSON.parse(JSON.stringify(this.prop.$areas[e]))}if(this.extFlag.memo){t.memos={};for(let e in this.prop.$memos)t.memos[e]=JSON.parse(JSON.stringify(this.prop.$memos[e]))}t.extra={};for(let e in this.prop.$extra)t.extra[e]=JSON.parse(JSON.stringify(this.prop.$extra[e]));return t},exportAlter(){let t={nodes:{},lines:{}};for(let e in this.prop.$nodes)this.prop.$nodes[e].alt&&(t.nodes[e]=this.prop.$nodes[e]);for(let e in this.prop.$lines)this.prop.$lines[e].alt&&(t.lines[e]=this.prop.$lines[e]);if(this.extFlag.group){t.areas={};for(let e in this.prop.$areas)this.prop.$areas[e].alt&&(t.areas[e]=this.prop.$areas[e])}if(this.extFlag.memo){t.memos={};for(let e in this.prop.$memos)this.prop.$memos[e].alt&&(t.memos[e]=this.prop.$memos[e])}return t.deletedItem=this.prop.$deletedItem,t},transNewId(t,e,s){let i=null,r=null;switch(s){case"node":r=this.prop.$nodes;break;case"line":r=this.prop.$lines;break;case"area":r=this.prop.$areas;break;case"memo":r=this.prop.$memos}if(null!=r&&r[t]&&(i=JSON.parse(JSON.stringify(this.prop.$areas[t])),delete r[t],this.$set(this.prop["$"+s+"s"],e,i),"area"===s))for(let s in this.prop.$nodes)(i=this.prop.$nodes[s]).areaId===t&&(this.prop.$nodes[s].areaId=e);if(t!==this.prop.$focus||"node"!==s&&"line"!==s||this.$set(this.prop.$focus,e),"function"==typeof this.pushOper&&null!=r){let i=[e,t,s];this.pushOper("transNewId",i)}},clearData(t){if(this.extFlag.group){for(let t in this.prop.$areas)delete this.prop.$areas[t];this.prop.$areaCount=0}if(this.extFlag.memo){for(let t in this.prop.$memos)delete this.prop.$memos[t];this.prop.$memoCount=0}for(let t in this.prop.$extra)delete this.prop.$extra[t];this.prop.$max=1;for(let t in this.prop.$deletedItem)delete this.prop.$deletedItem[t];this.prop.$focus="";for(let t in this.prop.$lines)delete this.prop.$lines[t];this.prop.$lineCount=0;for(let t in this.prop.$nodes)delete this.prop.$nodes[t];this.prop.$nodeCount=0,t||this.$set(this.prop,"$nodes",{}),"function"==typeof this.pushOper&&(this.prop.$undoStack.splice(0,this.prop.$undoStack.length),this.prop.$redoStack.splice(0,this.prop.$redoStack.length)),this.prop.$navMap&&this.$nextTick(function(){this.refreshMap()})},reinitSize(t,e){let s=t||this.$el.clientWidth,i=e||this.$el.clientHeight;this.$el.style.width=s+"px",this.$el.style.height=i+"px",this.opts.width=s,this.opts.height=i;let r=0,p=8;this.opts.haveHead&&(r=26,p=7),this.opts.haveTool&&(this.$refs.$tool.$el.style.height=i-r-p+"px",s-=31),s-=9,i=i-r-(this.opts.haveHead?5:8),this.$refs.$workArea.offsetWidth>s&&(s=this.$refs.$workArea.offsetWidth),this.$refs.$workArea.offsetHeight>i&&(i=this.$refs.$workArea.offsetHeight),this.$refs.$workArea.style.width=s+"px",this.$refs.$workArea.style.height=i+"px",this.$refs.$alignV&&(this.$refs.$alignV.style.width=s+"px"),this.$refs.$alignH&&(this.$refs.$alignH.style.height=i+"px"),this.prop.$navMap&&this.$nextTick(function(){this.refreshMap()})},resetScale(t){if(t?t<.5?t=.5:t>4&&(t=4):t=1,this.scale===t)return;this.scale=t;let e=0,s=0;this.blurItem();let i=this._suitSize();e=i.width+this.prop.$workExtendStep,s=i.height+this.prop.$workExtendStep,e<this.$refs.$workArea.parentNode.clientWidth&&(e=this.$refs.$workArea.parentNode.clientWidth),s<this.$refs.$workArea.parentNode.clientHeight&&(s=this.$refs.$workArea.parentNode.clientHeight),this.$refs.$workArea.style.width=e+"px",this.$refs.$workArea.style.height=s+"px",this.$refs.$alignV&&(this.$refs.$alignV.style.width=e+"px"),this.$refs.$alignH&&(this.$refs.$alignH.style.height=s+"px"),this.prop.$navMap&&this.$nextTick(function(){this.refreshMap()}),void 0===this._tmpScaleValue&&(this._tmpScaleValue=document.createElement("div"),this._tmpScaleValue.id=this.prop.$id+"_scaleValue",this._tmpScaleValue.style.cssText="width:360px;height:120px;line-height:100%;position:absolute;display:block;margin:-60px 0 0 -"+(180-(this.opts.haveTool?0:this.$refs.$tool.$el.offsetWidth))+"px;top:50%;left:50%;text-align:center;font-weight:bold;color:rgba(0,0,0,.1);font-size:120px !important;",this.$el.appendChild(this._tmpScaleValue)),this._tmpScaleValue.innerText=Math.round(1e4*this.scale)/100+"%",this._tmpTimeout&&(clearTimeout(this._tmpTimeout),delete this._tmpTimeout),this._tmpScaleValue.style.display="block";let r=this;this._tmpTimeout=setTimeout(function(){r._tmpScaleValue.style.display="none"},600)},extend(t){for(let e in t)this[e]=t[e]},},mounted(){let t=this.$el.querySelector(".GooFlow_work");t.style.left=this.opts.haveTool?(this.opts.toolTextWidth||0)+34+"px":"3px",t.style.top=this.opts.haveHead?"28px":"3px";let e=this.$refs.$workArea;e.style.width=e.parentNode.offsetWidth+"px",e.style.height=e.parentNode.offsetHeight+"px";let o=document.createElement("style"),i=".GooFlow_work_inner.crosshair .GooFlow_item:hover{border-color:"+this.global.color.mark+" !important}";o.type="text/css",Goo.draw(),o.styleSheet?o.styleSheet.cssText=i:o.innerHTML=i,e.parentNode.insertBefore(o,e),this._initDraw(),this._initWorkForNode(),this.prop.$editable&&(this._initEditFunc(),this._initExpendFunc(),this.extFlag.dragadd&&this._initDragAddOper());let l=this;e.addEventListener("click",function(t){l._renderClick(t)}),this.extFlag.group&&this._initGroup(),this.extFlag.memo&&this._initMemo(),this.extFlag.multi&&this._initMultiSelect("ctrl"===this.opts.multiKey?"ctrl":"shift"),this.extFlag.navmap&&this._initNavMap(this.navSelector),this._bindScrollScaleEvent()}};